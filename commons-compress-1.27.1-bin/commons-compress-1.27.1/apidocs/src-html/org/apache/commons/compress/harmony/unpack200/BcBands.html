<!DOCTYPE HTML>
<html lang>
<head>
<!-- Generated by javadoc (17) -->
<title>Source code</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="source: package: org.apache.commons.compress.harmony.unpack200, class: BcBands">
<meta name="generator" content="javadoc/SourceToHTMLConverter">
<link rel="stylesheet" type="text/css" href="../../../../../../../stylesheet.css" title="Style">
</head>
<body class="source-page">
<main role="main">
<div class="source-container">
<pre><span class="source-line-no">001</span><span id="line-1">/*</span>
<span class="source-line-no">002</span><span id="line-2"> *  Licensed to the Apache Software Foundation (ASF) under one or more</span>
<span class="source-line-no">003</span><span id="line-3"> *  contributor license agreements.  See the NOTICE file distributed with</span>
<span class="source-line-no">004</span><span id="line-4"> *  this work for additional information regarding copyright ownership.</span>
<span class="source-line-no">005</span><span id="line-5"> *  The ASF licenses this file to You under the Apache License, Version 2.0</span>
<span class="source-line-no">006</span><span id="line-6"> *  (the "License"); you may not use this file except in compliance with</span>
<span class="source-line-no">007</span><span id="line-7"> *  the License.  You may obtain a copy of the License at</span>
<span class="source-line-no">008</span><span id="line-8"> *</span>
<span class="source-line-no">009</span><span id="line-9"> *     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="source-line-no">010</span><span id="line-10"> *</span>
<span class="source-line-no">011</span><span id="line-11"> *  Unless required by applicable law or agreed to in writing, software</span>
<span class="source-line-no">012</span><span id="line-12"> *  distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="source-line-no">013</span><span id="line-13"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="source-line-no">014</span><span id="line-14"> *  See the License for the specific language governing permissions and</span>
<span class="source-line-no">015</span><span id="line-15"> *  limitations under the License.</span>
<span class="source-line-no">016</span><span id="line-16"> */</span>
<span class="source-line-no">017</span><span id="line-17">package org.apache.commons.compress.harmony.unpack200;</span>
<span class="source-line-no">018</span><span id="line-18"></span>
<span class="source-line-no">019</span><span id="line-19">import java.io.ByteArrayOutputStream;</span>
<span class="source-line-no">020</span><span id="line-20">import java.io.IOException;</span>
<span class="source-line-no">021</span><span id="line-21">import java.io.InputStream;</span>
<span class="source-line-no">022</span><span id="line-22">import java.util.ArrayList;</span>
<span class="source-line-no">023</span><span id="line-23">import java.util.Collections;</span>
<span class="source-line-no">024</span><span id="line-24">import java.util.List;</span>
<span class="source-line-no">025</span><span id="line-25"></span>
<span class="source-line-no">026</span><span id="line-26">import org.apache.commons.compress.harmony.pack200.Codec;</span>
<span class="source-line-no">027</span><span id="line-27">import org.apache.commons.compress.harmony.pack200.Pack200Exception;</span>
<span class="source-line-no">028</span><span id="line-28">import org.apache.commons.compress.harmony.unpack200.bytecode.Attribute;</span>
<span class="source-line-no">029</span><span id="line-29">import org.apache.commons.compress.harmony.unpack200.bytecode.BCIRenumberedAttribute;</span>
<span class="source-line-no">030</span><span id="line-30">import org.apache.commons.compress.harmony.unpack200.bytecode.ByteCode;</span>
<span class="source-line-no">031</span><span id="line-31">import org.apache.commons.compress.harmony.unpack200.bytecode.CPClass;</span>
<span class="source-line-no">032</span><span id="line-32">import org.apache.commons.compress.harmony.unpack200.bytecode.CodeAttribute;</span>
<span class="source-line-no">033</span><span id="line-33">import org.apache.commons.compress.harmony.unpack200.bytecode.ExceptionTableEntry;</span>
<span class="source-line-no">034</span><span id="line-34">import org.apache.commons.compress.harmony.unpack200.bytecode.NewAttribute;</span>
<span class="source-line-no">035</span><span id="line-35">import org.apache.commons.compress.harmony.unpack200.bytecode.OperandManager;</span>
<span class="source-line-no">036</span><span id="line-36"></span>
<span class="source-line-no">037</span><span id="line-37">/**</span>
<span class="source-line-no">038</span><span id="line-38"> * Bytecode bands</span>
<span class="source-line-no">039</span><span id="line-39"> */</span>
<span class="source-line-no">040</span><span id="line-40">public class BcBands extends BandSet {</span>
<span class="source-line-no">041</span><span id="line-41"></span>
<span class="source-line-no">042</span><span id="line-42">    // The bytecodes for each method in each class as they come (i.e. in their</span>
<span class="source-line-no">043</span><span id="line-43">    // packed format)</span>
<span class="source-line-no">044</span><span id="line-44">    private byte[][][] methodByteCodePacked;</span>
<span class="source-line-no">045</span><span id="line-45"></span>
<span class="source-line-no">046</span><span id="line-46">    // The bands</span>
<span class="source-line-no">047</span><span id="line-47">    // TODO: Haven't resolved references yet. Do we want to?</span>
<span class="source-line-no">048</span><span id="line-48">    private int[] bcCaseCount;</span>
<span class="source-line-no">049</span><span id="line-49">    private int[] bcCaseValue;</span>
<span class="source-line-no">050</span><span id="line-50">    private int[] bcByte;</span>
<span class="source-line-no">051</span><span id="line-51">    private int[] bcLocal;</span>
<span class="source-line-no">052</span><span id="line-52">    private int[] bcShort;</span>
<span class="source-line-no">053</span><span id="line-53">    private int[] bcLabel;</span>
<span class="source-line-no">054</span><span id="line-54">    private int[] bcIntRef;</span>
<span class="source-line-no">055</span><span id="line-55">    private int[] bcFloatRef;</span>
<span class="source-line-no">056</span><span id="line-56">    private int[] bcLongRef;</span>
<span class="source-line-no">057</span><span id="line-57">    private int[] bcDoubleRef;</span>
<span class="source-line-no">058</span><span id="line-58">    private int[] bcStringRef;</span>
<span class="source-line-no">059</span><span id="line-59">    private int[] bcClassRef;</span>
<span class="source-line-no">060</span><span id="line-60">    private int[] bcFieldRef;</span>
<span class="source-line-no">061</span><span id="line-61">    private int[] bcMethodRef;</span>
<span class="source-line-no">062</span><span id="line-62">    private int[] bcIMethodRef;</span>
<span class="source-line-no">063</span><span id="line-63">    private int[] bcThisField;</span>
<span class="source-line-no">064</span><span id="line-64">    private int[] bcSuperField;</span>
<span class="source-line-no">065</span><span id="line-65">    private int[] bcThisMethod;</span>
<span class="source-line-no">066</span><span id="line-66">    private int[] bcSuperMethod;</span>
<span class="source-line-no">067</span><span id="line-67">    private int[] bcInitRef;</span>
<span class="source-line-no">068</span><span id="line-68">    private int[] bcEscRef;</span>
<span class="source-line-no">069</span><span id="line-69">    private int[] bcEscRefSize;</span>
<span class="source-line-no">070</span><span id="line-70">    private int[] bcEscSize;</span>
<span class="source-line-no">071</span><span id="line-71">    private int[][] bcEscByte;</span>
<span class="source-line-no">072</span><span id="line-72"></span>
<span class="source-line-no">073</span><span id="line-73">    private List&lt;Integer&gt; wideByteCodes;</span>
<span class="source-line-no">074</span><span id="line-74"></span>
<span class="source-line-no">075</span><span id="line-75">    /**</span>
<span class="source-line-no">076</span><span id="line-76">     * @param segment TODO</span>
<span class="source-line-no">077</span><span id="line-77">     */</span>
<span class="source-line-no">078</span><span id="line-78">    public BcBands(final Segment segment) {</span>
<span class="source-line-no">079</span><span id="line-79">        super(segment);</span>
<span class="source-line-no">080</span><span id="line-80">    }</span>
<span class="source-line-no">081</span><span id="line-81"></span>
<span class="source-line-no">082</span><span id="line-82">    private boolean endsWithLoad(final int codePacked) {</span>
<span class="source-line-no">083</span><span id="line-83">        return codePacked &gt;= 21 &amp;&amp; codePacked &lt;= 25;</span>
<span class="source-line-no">084</span><span id="line-84">    }</span>
<span class="source-line-no">085</span><span id="line-85"></span>
<span class="source-line-no">086</span><span id="line-86">    private boolean endsWithStore(final int codePacked) {</span>
<span class="source-line-no">087</span><span id="line-87">        return codePacked &gt;= 54 &amp;&amp; codePacked &lt;= 58;</span>
<span class="source-line-no">088</span><span id="line-88">    }</span>
<span class="source-line-no">089</span><span id="line-89"></span>
<span class="source-line-no">090</span><span id="line-90">    public int[] getBcByte() {</span>
<span class="source-line-no">091</span><span id="line-91">        return bcByte;</span>
<span class="source-line-no">092</span><span id="line-92">    }</span>
<span class="source-line-no">093</span><span id="line-93"></span>
<span class="source-line-no">094</span><span id="line-94">    public int[] getBcCaseCount() {</span>
<span class="source-line-no">095</span><span id="line-95">        return bcCaseCount;</span>
<span class="source-line-no">096</span><span id="line-96">    }</span>
<span class="source-line-no">097</span><span id="line-97"></span>
<span class="source-line-no">098</span><span id="line-98">    public int[] getBcCaseValue() {</span>
<span class="source-line-no">099</span><span id="line-99">        return bcCaseValue;</span>
<span class="source-line-no">100</span><span id="line-100">    }</span>
<span class="source-line-no">101</span><span id="line-101"></span>
<span class="source-line-no">102</span><span id="line-102">    public int[] getBcClassRef() {</span>
<span class="source-line-no">103</span><span id="line-103">        return bcClassRef;</span>
<span class="source-line-no">104</span><span id="line-104">    }</span>
<span class="source-line-no">105</span><span id="line-105"></span>
<span class="source-line-no">106</span><span id="line-106">    public int[] getBcDoubleRef() {</span>
<span class="source-line-no">107</span><span id="line-107">        return bcDoubleRef;</span>
<span class="source-line-no">108</span><span id="line-108">    }</span>
<span class="source-line-no">109</span><span id="line-109"></span>
<span class="source-line-no">110</span><span id="line-110">    public int[] getBcFieldRef() {</span>
<span class="source-line-no">111</span><span id="line-111">        return bcFieldRef;</span>
<span class="source-line-no">112</span><span id="line-112">    }</span>
<span class="source-line-no">113</span><span id="line-113"></span>
<span class="source-line-no">114</span><span id="line-114">    public int[] getBcFloatRef() {</span>
<span class="source-line-no">115</span><span id="line-115">        return bcFloatRef;</span>
<span class="source-line-no">116</span><span id="line-116">    }</span>
<span class="source-line-no">117</span><span id="line-117"></span>
<span class="source-line-no">118</span><span id="line-118">    public int[] getBcIMethodRef() {</span>
<span class="source-line-no">119</span><span id="line-119">        return bcIMethodRef;</span>
<span class="source-line-no">120</span><span id="line-120">    }</span>
<span class="source-line-no">121</span><span id="line-121"></span>
<span class="source-line-no">122</span><span id="line-122">    public int[] getBcInitRef() {</span>
<span class="source-line-no">123</span><span id="line-123">        return bcInitRef;</span>
<span class="source-line-no">124</span><span id="line-124">    }</span>
<span class="source-line-no">125</span><span id="line-125"></span>
<span class="source-line-no">126</span><span id="line-126">    public int[] getBcIntRef() {</span>
<span class="source-line-no">127</span><span id="line-127">        return bcIntRef;</span>
<span class="source-line-no">128</span><span id="line-128">    }</span>
<span class="source-line-no">129</span><span id="line-129"></span>
<span class="source-line-no">130</span><span id="line-130">    public int[] getBcLabel() {</span>
<span class="source-line-no">131</span><span id="line-131">        return bcLabel;</span>
<span class="source-line-no">132</span><span id="line-132">    }</span>
<span class="source-line-no">133</span><span id="line-133"></span>
<span class="source-line-no">134</span><span id="line-134">    public int[] getBcLocal() {</span>
<span class="source-line-no">135</span><span id="line-135">        return bcLocal;</span>
<span class="source-line-no">136</span><span id="line-136">    }</span>
<span class="source-line-no">137</span><span id="line-137"></span>
<span class="source-line-no">138</span><span id="line-138">    public int[] getBcLongRef() {</span>
<span class="source-line-no">139</span><span id="line-139">        return bcLongRef;</span>
<span class="source-line-no">140</span><span id="line-140">    }</span>
<span class="source-line-no">141</span><span id="line-141"></span>
<span class="source-line-no">142</span><span id="line-142">    public int[] getBcMethodRef() {</span>
<span class="source-line-no">143</span><span id="line-143">        return bcMethodRef;</span>
<span class="source-line-no">144</span><span id="line-144">    }</span>
<span class="source-line-no">145</span><span id="line-145"></span>
<span class="source-line-no">146</span><span id="line-146">    public int[] getBcShort() {</span>
<span class="source-line-no">147</span><span id="line-147">        return bcShort;</span>
<span class="source-line-no">148</span><span id="line-148">    }</span>
<span class="source-line-no">149</span><span id="line-149"></span>
<span class="source-line-no">150</span><span id="line-150">    public int[] getBcStringRef() {</span>
<span class="source-line-no">151</span><span id="line-151">        return bcStringRef;</span>
<span class="source-line-no">152</span><span id="line-152">    }</span>
<span class="source-line-no">153</span><span id="line-153"></span>
<span class="source-line-no">154</span><span id="line-154">    public int[] getBcSuperField() {</span>
<span class="source-line-no">155</span><span id="line-155">        return bcSuperField;</span>
<span class="source-line-no">156</span><span id="line-156">    }</span>
<span class="source-line-no">157</span><span id="line-157"></span>
<span class="source-line-no">158</span><span id="line-158">    public int[] getBcSuperMethod() {</span>
<span class="source-line-no">159</span><span id="line-159">        return bcSuperMethod;</span>
<span class="source-line-no">160</span><span id="line-160">    }</span>
<span class="source-line-no">161</span><span id="line-161"></span>
<span class="source-line-no">162</span><span id="line-162">    public int[] getBcThisField() {</span>
<span class="source-line-no">163</span><span id="line-163">        return bcThisField;</span>
<span class="source-line-no">164</span><span id="line-164">    }</span>
<span class="source-line-no">165</span><span id="line-165"></span>
<span class="source-line-no">166</span><span id="line-166">    public int[] getBcThisMethod() {</span>
<span class="source-line-no">167</span><span id="line-167">        return bcThisMethod;</span>
<span class="source-line-no">168</span><span id="line-168">    }</span>
<span class="source-line-no">169</span><span id="line-169"></span>
<span class="source-line-no">170</span><span id="line-170">    public byte[][][] getMethodByteCodePacked() {</span>
<span class="source-line-no">171</span><span id="line-171">        return methodByteCodePacked;</span>
<span class="source-line-no">172</span><span id="line-172">    }</span>
<span class="source-line-no">173</span><span id="line-173"></span>
<span class="source-line-no">174</span><span id="line-174">    /*</span>
<span class="source-line-no">175</span><span id="line-175">     * (non-Javadoc)</span>
<span class="source-line-no">176</span><span id="line-176">     *</span>
<span class="source-line-no">177</span><span id="line-177">     * @see org.apache.commons.compress.harmony.unpack200.BandSet#unpack(java.io.InputStream)</span>
<span class="source-line-no">178</span><span id="line-178">     */</span>
<span class="source-line-no">179</span><span id="line-179">    @Override</span>
<span class="source-line-no">180</span><span id="line-180">    public void read(final InputStream in) throws IOException, Pack200Exception {</span>
<span class="source-line-no">181</span><span id="line-181"></span>
<span class="source-line-no">182</span><span id="line-182">        final AttributeLayoutMap attributeDefinitionMap = segment.getAttrDefinitionBands().getAttributeDefinitionMap();</span>
<span class="source-line-no">183</span><span id="line-183">        final int classCount = header.getClassCount();</span>
<span class="source-line-no">184</span><span id="line-184">        final long[][] methodFlags = segment.getClassBands().getMethodFlags();</span>
<span class="source-line-no">185</span><span id="line-185"></span>
<span class="source-line-no">186</span><span id="line-186">        int bcCaseCountCount = 0;</span>
<span class="source-line-no">187</span><span id="line-187">        int bcByteCount = 0;</span>
<span class="source-line-no">188</span><span id="line-188">        int bcShortCount = 0;</span>
<span class="source-line-no">189</span><span id="line-189">        int bcLocalCount = 0;</span>
<span class="source-line-no">190</span><span id="line-190">        int bcLabelCount = 0;</span>
<span class="source-line-no">191</span><span id="line-191">        int bcIntRefCount = 0;</span>
<span class="source-line-no">192</span><span id="line-192">        int bcFloatRefCount = 0;</span>
<span class="source-line-no">193</span><span id="line-193">        int bcLongRefCount = 0;</span>
<span class="source-line-no">194</span><span id="line-194">        int bcDoubleRefCount = 0;</span>
<span class="source-line-no">195</span><span id="line-195">        int bcStringRefCount = 0;</span>
<span class="source-line-no">196</span><span id="line-196">        int bcClassRefCount = 0;</span>
<span class="source-line-no">197</span><span id="line-197">        int bcFieldRefCount = 0;</span>
<span class="source-line-no">198</span><span id="line-198">        int bcMethodRefCount = 0;</span>
<span class="source-line-no">199</span><span id="line-199">        int bcIMethodRefCount = 0;</span>
<span class="source-line-no">200</span><span id="line-200">        int bcThisFieldCount = 0;</span>
<span class="source-line-no">201</span><span id="line-201">        int bcSuperFieldCount = 0;</span>
<span class="source-line-no">202</span><span id="line-202">        int bcThisMethodCount = 0;</span>
<span class="source-line-no">203</span><span id="line-203">        int bcSuperMethodCount = 0;</span>
<span class="source-line-no">204</span><span id="line-204">        int bcInitRefCount = 0;</span>
<span class="source-line-no">205</span><span id="line-205">        int bcEscCount = 0;</span>
<span class="source-line-no">206</span><span id="line-206">        int bcEscRefCount = 0;</span>
<span class="source-line-no">207</span><span id="line-207"></span>
<span class="source-line-no">208</span><span id="line-208">        final AttributeLayout abstractModifier = attributeDefinitionMap.getAttributeLayout(AttributeLayout.ACC_ABSTRACT, AttributeLayout.CONTEXT_METHOD);</span>
<span class="source-line-no">209</span><span id="line-209">        final AttributeLayout nativeModifier = attributeDefinitionMap.getAttributeLayout(AttributeLayout.ACC_NATIVE, AttributeLayout.CONTEXT_METHOD);</span>
<span class="source-line-no">210</span><span id="line-210"></span>
<span class="source-line-no">211</span><span id="line-211">        methodByteCodePacked = new byte[classCount][][];</span>
<span class="source-line-no">212</span><span id="line-212"></span>
<span class="source-line-no">213</span><span id="line-213">        final List&lt;Boolean&gt; switchIsTableSwitch = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">214</span><span id="line-214">        wideByteCodes = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">215</span><span id="line-215">        for (int c = 0; c &lt; classCount; c++) {</span>
<span class="source-line-no">216</span><span id="line-216">            final int numberOfMethods = methodFlags[c].length;</span>
<span class="source-line-no">217</span><span id="line-217">            methodByteCodePacked[c] = new byte[numberOfMethods][];</span>
<span class="source-line-no">218</span><span id="line-218">            for (int m = 0; m &lt; numberOfMethods; m++) {</span>
<span class="source-line-no">219</span><span id="line-219">                final long methodFlag = methodFlags[c][m];</span>
<span class="source-line-no">220</span><span id="line-220">                if (!abstractModifier.matches(methodFlag) &amp;&amp; !nativeModifier.matches(methodFlag)) {</span>
<span class="source-line-no">221</span><span id="line-221">                    final ByteArrayOutputStream codeBytes = new ByteArrayOutputStream();</span>
<span class="source-line-no">222</span><span id="line-222">                    byte code;</span>
<span class="source-line-no">223</span><span id="line-223">                    while ((code = (byte) (0xff &amp; in.read())) != -1) {</span>
<span class="source-line-no">224</span><span id="line-224">                        codeBytes.write(code);</span>
<span class="source-line-no">225</span><span id="line-225">                    }</span>
<span class="source-line-no">226</span><span id="line-226">                    methodByteCodePacked[c][m] = codeBytes.toByteArray();</span>
<span class="source-line-no">227</span><span id="line-227">                    final int[] codes = new int[methodByteCodePacked[c][m].length];</span>
<span class="source-line-no">228</span><span id="line-228">                    for (int i = 0; i &lt; codes.length; i++) {</span>
<span class="source-line-no">229</span><span id="line-229">                        codes[i] = methodByteCodePacked[c][m][i] &amp; 0xff;</span>
<span class="source-line-no">230</span><span id="line-230">                    }</span>
<span class="source-line-no">231</span><span id="line-231">                    for (int i = 0; i &lt; methodByteCodePacked[c][m].length; i++) {</span>
<span class="source-line-no">232</span><span id="line-232">                        final int codePacked = 0xff &amp; methodByteCodePacked[c][m][i];</span>
<span class="source-line-no">233</span><span id="line-233">                        switch (codePacked) {</span>
<span class="source-line-no">234</span><span id="line-234">                        case 16: // bipush</span>
<span class="source-line-no">235</span><span id="line-235">                        case 188: // newarray</span>
<span class="source-line-no">236</span><span id="line-236">                            bcByteCount++;</span>
<span class="source-line-no">237</span><span id="line-237">                            break;</span>
<span class="source-line-no">238</span><span id="line-238">                        case 17: // sipush</span>
<span class="source-line-no">239</span><span id="line-239">                            bcShortCount++;</span>
<span class="source-line-no">240</span><span id="line-240">                            break;</span>
<span class="source-line-no">241</span><span id="line-241">                        case 18: // (a)ldc</span>
<span class="source-line-no">242</span><span id="line-242">                        case 19: // aldc_w</span>
<span class="source-line-no">243</span><span id="line-243">                            bcStringRefCount++;</span>
<span class="source-line-no">244</span><span id="line-244">                            break;</span>
<span class="source-line-no">245</span><span id="line-245">                        case 234: // ildc</span>
<span class="source-line-no">246</span><span id="line-246">                        case 237: // ildc_w</span>
<span class="source-line-no">247</span><span id="line-247">                            bcIntRefCount++;</span>
<span class="source-line-no">248</span><span id="line-248">                            break;</span>
<span class="source-line-no">249</span><span id="line-249">                        case 235: // fldc</span>
<span class="source-line-no">250</span><span id="line-250">                        case 238: // fldc_w</span>
<span class="source-line-no">251</span><span id="line-251">                            bcFloatRefCount++;</span>
<span class="source-line-no">252</span><span id="line-252">                            break;</span>
<span class="source-line-no">253</span><span id="line-253">                        case 197: // multianewarray</span>
<span class="source-line-no">254</span><span id="line-254">                            bcByteCount++;</span>
<span class="source-line-no">255</span><span id="line-255">                            // fallthrough intended</span>
<span class="source-line-no">256</span><span id="line-256">                        case 233: // cldc</span>
<span class="source-line-no">257</span><span id="line-257">                        case 236: // cldc_w</span>
<span class="source-line-no">258</span><span id="line-258">                        case 187: // new</span>
<span class="source-line-no">259</span><span id="line-259">                        case 189: // anewarray</span>
<span class="source-line-no">260</span><span id="line-260">                        case 192: // checkcast</span>
<span class="source-line-no">261</span><span id="line-261">                        case 193: // instanceof</span>
<span class="source-line-no">262</span><span id="line-262">                            bcClassRefCount++;</span>
<span class="source-line-no">263</span><span id="line-263">                            break;</span>
<span class="source-line-no">264</span><span id="line-264">                        case 20: // lldc2_w</span>
<span class="source-line-no">265</span><span id="line-265">                            bcLongRefCount++;</span>
<span class="source-line-no">266</span><span id="line-266">                            break;</span>
<span class="source-line-no">267</span><span id="line-267">                        case 239: // dldc2_w</span>
<span class="source-line-no">268</span><span id="line-268">                            bcDoubleRefCount++;</span>
<span class="source-line-no">269</span><span id="line-269">                            break;</span>
<span class="source-line-no">270</span><span id="line-270">                        case 169: // ret</span>
<span class="source-line-no">271</span><span id="line-271">                            bcLocalCount++;</span>
<span class="source-line-no">272</span><span id="line-272">                            break;</span>
<span class="source-line-no">273</span><span id="line-273">                        case 167: // goto</span>
<span class="source-line-no">274</span><span id="line-274">                        case 168: // jsr</span>
<span class="source-line-no">275</span><span id="line-275">                        case 200: // goto_w</span>
<span class="source-line-no">276</span><span id="line-276">                        case 201: // jsr_w</span>
<span class="source-line-no">277</span><span id="line-277">                            bcLabelCount++;</span>
<span class="source-line-no">278</span><span id="line-278">                            break;</span>
<span class="source-line-no">279</span><span id="line-279">                        case 170: // tableswitch</span>
<span class="source-line-no">280</span><span id="line-280">                            switchIsTableSwitch.add(Boolean.TRUE);</span>
<span class="source-line-no">281</span><span id="line-281">                            bcCaseCountCount++;</span>
<span class="source-line-no">282</span><span id="line-282">                            bcLabelCount++;</span>
<span class="source-line-no">283</span><span id="line-283">                            break;</span>
<span class="source-line-no">284</span><span id="line-284">                        case 171: // lookupswitch</span>
<span class="source-line-no">285</span><span id="line-285">                            switchIsTableSwitch.add(Boolean.FALSE);</span>
<span class="source-line-no">286</span><span id="line-286">                            bcCaseCountCount++;</span>
<span class="source-line-no">287</span><span id="line-287">                            bcLabelCount++;</span>
<span class="source-line-no">288</span><span id="line-288">                            break;</span>
<span class="source-line-no">289</span><span id="line-289">                        case 178: // getstatic</span>
<span class="source-line-no">290</span><span id="line-290">                        case 179: // putstatic</span>
<span class="source-line-no">291</span><span id="line-291">                        case 180: // getfield</span>
<span class="source-line-no">292</span><span id="line-292">                        case 181: // putfield</span>
<span class="source-line-no">293</span><span id="line-293">                            bcFieldRefCount++;</span>
<span class="source-line-no">294</span><span id="line-294">                            break;</span>
<span class="source-line-no">295</span><span id="line-295">                        case 182: // invokevirtual</span>
<span class="source-line-no">296</span><span id="line-296">                        case 183: // invokespecial</span>
<span class="source-line-no">297</span><span id="line-297">                        case 184: // invokestatic</span>
<span class="source-line-no">298</span><span id="line-298">                            bcMethodRefCount++;</span>
<span class="source-line-no">299</span><span id="line-299">                            break;</span>
<span class="source-line-no">300</span><span id="line-300">                        case 185: // invokeinterface</span>
<span class="source-line-no">301</span><span id="line-301">                            bcIMethodRefCount++;</span>
<span class="source-line-no">302</span><span id="line-302">                            break;</span>
<span class="source-line-no">303</span><span id="line-303">                        case 202: // getstatic_this</span>
<span class="source-line-no">304</span><span id="line-304">                        case 203: // putstatic_this</span>
<span class="source-line-no">305</span><span id="line-305">                        case 204: // getfield_this</span>
<span class="source-line-no">306</span><span id="line-306">                        case 205: // putfield_this</span>
<span class="source-line-no">307</span><span id="line-307">                        case 209: // aload_0_getstatic_this</span>
<span class="source-line-no">308</span><span id="line-308">                        case 210: // aload_0_putstatic_this</span>
<span class="source-line-no">309</span><span id="line-309">                        case 211: // aload_0_putfield_this</span>
<span class="source-line-no">310</span><span id="line-310">                        case 212: // aload_0_putfield_this</span>
<span class="source-line-no">311</span><span id="line-311">                            bcThisFieldCount++;</span>
<span class="source-line-no">312</span><span id="line-312">                            break;</span>
<span class="source-line-no">313</span><span id="line-313">                        case 206: // invokevirtual_this</span>
<span class="source-line-no">314</span><span id="line-314">                        case 207: // invokespecial_this</span>
<span class="source-line-no">315</span><span id="line-315">                        case 208: // invokestatic_this</span>
<span class="source-line-no">316</span><span id="line-316">                        case 213: // aload_0_invokevirtual_this</span>
<span class="source-line-no">317</span><span id="line-317">                        case 214: // aload_0_invokespecial_this</span>
<span class="source-line-no">318</span><span id="line-318">                        case 215: // aload_0_invokestatic_this</span>
<span class="source-line-no">319</span><span id="line-319">                            bcThisMethodCount++;</span>
<span class="source-line-no">320</span><span id="line-320">                            break;</span>
<span class="source-line-no">321</span><span id="line-321">                        case 216: // getstatic_super</span>
<span class="source-line-no">322</span><span id="line-322">                        case 217: // putstatic_super</span>
<span class="source-line-no">323</span><span id="line-323">                        case 218: // getfield_super</span>
<span class="source-line-no">324</span><span id="line-324">                        case 219: // putfield_super</span>
<span class="source-line-no">325</span><span id="line-325">                        case 223: // aload_0_getstatic_super</span>
<span class="source-line-no">326</span><span id="line-326">                        case 224: // aload_0_putstatic_super</span>
<span class="source-line-no">327</span><span id="line-327">                        case 225: // aload_0_getfield_super</span>
<span class="source-line-no">328</span><span id="line-328">                        case 226: // aload_0_putfield_super</span>
<span class="source-line-no">329</span><span id="line-329">                            bcSuperFieldCount++;</span>
<span class="source-line-no">330</span><span id="line-330">                            break;</span>
<span class="source-line-no">331</span><span id="line-331">                        case 220: // invokevirtual_super</span>
<span class="source-line-no">332</span><span id="line-332">                        case 221: // invokespecial_super</span>
<span class="source-line-no">333</span><span id="line-333">                        case 222: // invokestatic_super</span>
<span class="source-line-no">334</span><span id="line-334">                        case 227: // aload_0_invokevirtual_super</span>
<span class="source-line-no">335</span><span id="line-335">                        case 228: // aload_0_invokespecial_super</span>
<span class="source-line-no">336</span><span id="line-336">                        case 229: // aload_0_invokestatic_super</span>
<span class="source-line-no">337</span><span id="line-337">                            bcSuperMethodCount++;</span>
<span class="source-line-no">338</span><span id="line-338">                            break;</span>
<span class="source-line-no">339</span><span id="line-339">                        case 132: // iinc</span>
<span class="source-line-no">340</span><span id="line-340">                            bcLocalCount++;</span>
<span class="source-line-no">341</span><span id="line-341">                            bcByteCount++;</span>
<span class="source-line-no">342</span><span id="line-342">                            break;</span>
<span class="source-line-no">343</span><span id="line-343">                        case 196: // wide</span>
<span class="source-line-no">344</span><span id="line-344">                            final int nextInstruction = 0xff &amp; methodByteCodePacked[c][m][i + 1];</span>
<span class="source-line-no">345</span><span id="line-345">                            wideByteCodes.add(Integer.valueOf(nextInstruction));</span>
<span class="source-line-no">346</span><span id="line-346">                            if (nextInstruction == 132) { // iinc</span>
<span class="source-line-no">347</span><span id="line-347">                                bcLocalCount++;</span>
<span class="source-line-no">348</span><span id="line-348">                                bcShortCount++;</span>
<span class="source-line-no">349</span><span id="line-349">                            } else if (endsWithLoad(nextInstruction) || endsWithStore(nextInstruction) || nextInstruction == 169) {</span>
<span class="source-line-no">350</span><span id="line-350">                                bcLocalCount++;</span>
<span class="source-line-no">351</span><span id="line-351">                            } else {</span>
<span class="source-line-no">352</span><span id="line-352">                                segment.log(Segment.LOG_LEVEL_VERBOSE, "Found unhandled " + ByteCode.getByteCode(nextInstruction));</span>
<span class="source-line-no">353</span><span id="line-353">                            }</span>
<span class="source-line-no">354</span><span id="line-354">                            i++;</span>
<span class="source-line-no">355</span><span id="line-355">                            break;</span>
<span class="source-line-no">356</span><span id="line-356">                        case 230: // invokespecial_this_init</span>
<span class="source-line-no">357</span><span id="line-357">                        case 231: // invokespecial_super_init</span>
<span class="source-line-no">358</span><span id="line-358">                        case 232: // invokespecial_new_init</span>
<span class="source-line-no">359</span><span id="line-359">                            bcInitRefCount++;</span>
<span class="source-line-no">360</span><span id="line-360">                            break;</span>
<span class="source-line-no">361</span><span id="line-361">                        case 253: // ref_escape</span>
<span class="source-line-no">362</span><span id="line-362">                            bcEscRefCount++;</span>
<span class="source-line-no">363</span><span id="line-363">                            break;</span>
<span class="source-line-no">364</span><span id="line-364">                        case 254: // byte_escape</span>
<span class="source-line-no">365</span><span id="line-365">                            bcEscCount++;</span>
<span class="source-line-no">366</span><span id="line-366">                            break;</span>
<span class="source-line-no">367</span><span id="line-367">                        default:</span>
<span class="source-line-no">368</span><span id="line-368">                            if (endsWithLoad(codePacked) || endsWithStore(codePacked)) {</span>
<span class="source-line-no">369</span><span id="line-369">                                bcLocalCount++;</span>
<span class="source-line-no">370</span><span id="line-370">                            } else if (startsWithIf(codePacked)) {</span>
<span class="source-line-no">371</span><span id="line-371">                                bcLabelCount++;</span>
<span class="source-line-no">372</span><span id="line-372">                            }</span>
<span class="source-line-no">373</span><span id="line-373">                        }</span>
<span class="source-line-no">374</span><span id="line-374">                    }</span>
<span class="source-line-no">375</span><span id="line-375">                }</span>
<span class="source-line-no">376</span><span id="line-376">            }</span>
<span class="source-line-no">377</span><span id="line-377">        }</span>
<span class="source-line-no">378</span><span id="line-378">        // other bytecode bands</span>
<span class="source-line-no">379</span><span id="line-379">        bcCaseCount = decodeBandInt("bc_case_count", in, Codec.UNSIGNED5, bcCaseCountCount);</span>
<span class="source-line-no">380</span><span id="line-380">        int bcCaseValueCount = 0;</span>
<span class="source-line-no">381</span><span id="line-381">        for (int i = 0; i &lt; bcCaseCount.length; i++) {</span>
<span class="source-line-no">382</span><span id="line-382">            final boolean isTableSwitch = switchIsTableSwitch.get(i).booleanValue();</span>
<span class="source-line-no">383</span><span id="line-383">            if (isTableSwitch) {</span>
<span class="source-line-no">384</span><span id="line-384">                bcCaseValueCount += 1;</span>
<span class="source-line-no">385</span><span id="line-385">            } else {</span>
<span class="source-line-no">386</span><span id="line-386">                bcCaseValueCount += bcCaseCount[i];</span>
<span class="source-line-no">387</span><span id="line-387">            }</span>
<span class="source-line-no">388</span><span id="line-388">        }</span>
<span class="source-line-no">389</span><span id="line-389">        bcCaseValue = decodeBandInt("bc_case_value", in, Codec.DELTA5, bcCaseValueCount);</span>
<span class="source-line-no">390</span><span id="line-390">        // Every case value needs a label. We weren't able to count these</span>
<span class="source-line-no">391</span><span id="line-391">        // above, because we didn't know how many cases there were.</span>
<span class="source-line-no">392</span><span id="line-392">        // Have to correct it now.</span>
<span class="source-line-no">393</span><span id="line-393">        for (int index = 0; index &lt; bcCaseCountCount; index++) {</span>
<span class="source-line-no">394</span><span id="line-394">            bcLabelCount += bcCaseCount[index];</span>
<span class="source-line-no">395</span><span id="line-395">        }</span>
<span class="source-line-no">396</span><span id="line-396">        bcByte = decodeBandInt("bc_byte", in, Codec.BYTE1, bcByteCount);</span>
<span class="source-line-no">397</span><span id="line-397">        bcShort = decodeBandInt("bc_short", in, Codec.DELTA5, bcShortCount);</span>
<span class="source-line-no">398</span><span id="line-398">        bcLocal = decodeBandInt("bc_local", in, Codec.UNSIGNED5, bcLocalCount);</span>
<span class="source-line-no">399</span><span id="line-399">        bcLabel = decodeBandInt("bc_label", in, Codec.BRANCH5, bcLabelCount);</span>
<span class="source-line-no">400</span><span id="line-400">        bcIntRef = decodeBandInt("bc_intref", in, Codec.DELTA5, bcIntRefCount);</span>
<span class="source-line-no">401</span><span id="line-401">        bcFloatRef = decodeBandInt("bc_floatref", in, Codec.DELTA5, bcFloatRefCount);</span>
<span class="source-line-no">402</span><span id="line-402">        bcLongRef = decodeBandInt("bc_longref", in, Codec.DELTA5, bcLongRefCount);</span>
<span class="source-line-no">403</span><span id="line-403">        bcDoubleRef = decodeBandInt("bc_doubleref", in, Codec.DELTA5, bcDoubleRefCount);</span>
<span class="source-line-no">404</span><span id="line-404">        bcStringRef = decodeBandInt("bc_stringref", in, Codec.DELTA5, bcStringRefCount);</span>
<span class="source-line-no">405</span><span id="line-405">        bcClassRef = decodeBandInt("bc_classref", in, Codec.UNSIGNED5, bcClassRefCount);</span>
<span class="source-line-no">406</span><span id="line-406">        bcFieldRef = decodeBandInt("bc_fieldref", in, Codec.DELTA5, bcFieldRefCount);</span>
<span class="source-line-no">407</span><span id="line-407">        bcMethodRef = decodeBandInt("bc_methodref", in, Codec.UNSIGNED5, bcMethodRefCount);</span>
<span class="source-line-no">408</span><span id="line-408">        bcIMethodRef = decodeBandInt("bc_imethodref", in, Codec.DELTA5, bcIMethodRefCount);</span>
<span class="source-line-no">409</span><span id="line-409">        bcThisField = decodeBandInt("bc_thisfield", in, Codec.UNSIGNED5, bcThisFieldCount);</span>
<span class="source-line-no">410</span><span id="line-410">        bcSuperField = decodeBandInt("bc_superfield", in, Codec.UNSIGNED5, bcSuperFieldCount);</span>
<span class="source-line-no">411</span><span id="line-411">        bcThisMethod = decodeBandInt("bc_thismethod", in, Codec.UNSIGNED5, bcThisMethodCount);</span>
<span class="source-line-no">412</span><span id="line-412">        bcSuperMethod = decodeBandInt("bc_supermethod", in, Codec.UNSIGNED5, bcSuperMethodCount);</span>
<span class="source-line-no">413</span><span id="line-413">        bcInitRef = decodeBandInt("bc_initref", in, Codec.UNSIGNED5, bcInitRefCount);</span>
<span class="source-line-no">414</span><span id="line-414">        bcEscRef = decodeBandInt("bc_escref", in, Codec.UNSIGNED5, bcEscRefCount);</span>
<span class="source-line-no">415</span><span id="line-415">        bcEscRefSize = decodeBandInt("bc_escrefsize", in, Codec.UNSIGNED5, bcEscRefCount);</span>
<span class="source-line-no">416</span><span id="line-416">        bcEscSize = decodeBandInt("bc_escsize", in, Codec.UNSIGNED5, bcEscCount);</span>
<span class="source-line-no">417</span><span id="line-417">        bcEscByte = decodeBandInt("bc_escbyte", in, Codec.BYTE1, bcEscSize);</span>
<span class="source-line-no">418</span><span id="line-418">    }</span>
<span class="source-line-no">419</span><span id="line-419"></span>
<span class="source-line-no">420</span><span id="line-420">    private boolean startsWithIf(final int codePacked) {</span>
<span class="source-line-no">421</span><span id="line-421">        return codePacked &gt;= 153 &amp;&amp; codePacked &lt;= 166 || codePacked == 198 || codePacked == 199;</span>
<span class="source-line-no">422</span><span id="line-422">    }</span>
<span class="source-line-no">423</span><span id="line-423"></span>
<span class="source-line-no">424</span><span id="line-424">    @Override</span>
<span class="source-line-no">425</span><span id="line-425">    public void unpack() throws Pack200Exception {</span>
<span class="source-line-no">426</span><span id="line-426">        final int classCount = header.getClassCount();</span>
<span class="source-line-no">427</span><span id="line-427">        final long[][] methodFlags = segment.getClassBands().getMethodFlags();</span>
<span class="source-line-no">428</span><span id="line-428">        final int[] codeMaxNALocals = segment.getClassBands().getCodeMaxNALocals();</span>
<span class="source-line-no">429</span><span id="line-429">        final int[] codeMaxStack = segment.getClassBands().getCodeMaxStack();</span>
<span class="source-line-no">430</span><span id="line-430">        final ArrayList&lt;Attribute&gt;[][] methodAttributes = segment.getClassBands().getMethodAttributes();</span>
<span class="source-line-no">431</span><span id="line-431">        final String[][] methodDescr = segment.getClassBands().getMethodDescr();</span>
<span class="source-line-no">432</span><span id="line-432"></span>
<span class="source-line-no">433</span><span id="line-433">        final AttributeLayoutMap attributeDefinitionMap = segment.getAttrDefinitionBands().getAttributeDefinitionMap();</span>
<span class="source-line-no">434</span><span id="line-434"></span>
<span class="source-line-no">435</span><span id="line-435">        final AttributeLayout abstractModifier = attributeDefinitionMap.getAttributeLayout(AttributeLayout.ACC_ABSTRACT, AttributeLayout.CONTEXT_METHOD);</span>
<span class="source-line-no">436</span><span id="line-436">        final AttributeLayout nativeModifier = attributeDefinitionMap.getAttributeLayout(AttributeLayout.ACC_NATIVE, AttributeLayout.CONTEXT_METHOD);</span>
<span class="source-line-no">437</span><span id="line-437">        final AttributeLayout staticModifier = attributeDefinitionMap.getAttributeLayout(AttributeLayout.ACC_STATIC, AttributeLayout.CONTEXT_METHOD);</span>
<span class="source-line-no">438</span><span id="line-438"></span>
<span class="source-line-no">439</span><span id="line-439">        final int[] wideByteCodeArray = new int[wideByteCodes.size()];</span>
<span class="source-line-no">440</span><span id="line-440">        for (int index = 0; index &lt; wideByteCodeArray.length; index++) {</span>
<span class="source-line-no">441</span><span id="line-441">            wideByteCodeArray[index] = wideByteCodes.get(index).intValue();</span>
<span class="source-line-no">442</span><span id="line-442">        }</span>
<span class="source-line-no">443</span><span id="line-443">        final OperandManager operandManager = new OperandManager(bcCaseCount, bcCaseValue, bcByte, bcShort, bcLocal, bcLabel, bcIntRef, bcFloatRef, bcLongRef,</span>
<span class="source-line-no">444</span><span id="line-444">                bcDoubleRef, bcStringRef, bcClassRef, bcFieldRef, bcMethodRef, bcIMethodRef, bcThisField, bcSuperField, bcThisMethod, bcSuperMethod, bcInitRef,</span>
<span class="source-line-no">445</span><span id="line-445">                wideByteCodeArray);</span>
<span class="source-line-no">446</span><span id="line-446">        operandManager.setSegment(segment);</span>
<span class="source-line-no">447</span><span id="line-447"></span>
<span class="source-line-no">448</span><span id="line-448">        int i = 0;</span>
<span class="source-line-no">449</span><span id="line-449">        final ArrayList&lt;List&lt;Attribute&gt;&gt; orderedCodeAttributes = segment.getClassBands().getOrderedCodeAttributes();</span>
<span class="source-line-no">450</span><span id="line-450">        int codeAttributeIndex = 0;</span>
<span class="source-line-no">451</span><span id="line-451"></span>
<span class="source-line-no">452</span><span id="line-452">        // Exception table fields</span>
<span class="source-line-no">453</span><span id="line-453">        final int[] handlerCount = segment.getClassBands().getCodeHandlerCount();</span>
<span class="source-line-no">454</span><span id="line-454">        final int[][] handlerStartPCs = segment.getClassBands().getCodeHandlerStartP();</span>
<span class="source-line-no">455</span><span id="line-455">        final int[][] handlerEndPCs = segment.getClassBands().getCodeHandlerEndPO();</span>
<span class="source-line-no">456</span><span id="line-456">        final int[][] handlerCatchPCs = segment.getClassBands().getCodeHandlerCatchPO();</span>
<span class="source-line-no">457</span><span id="line-457">        final int[][] handlerClassTypes = segment.getClassBands().getCodeHandlerClassRCN();</span>
<span class="source-line-no">458</span><span id="line-458"></span>
<span class="source-line-no">459</span><span id="line-459">        final boolean allCodeHasFlags = segment.getSegmentHeader().getOptions().hasAllCodeFlags();</span>
<span class="source-line-no">460</span><span id="line-460">        final boolean[] codeHasFlags = segment.getClassBands().getCodeHasAttributes();</span>
<span class="source-line-no">461</span><span id="line-461"></span>
<span class="source-line-no">462</span><span id="line-462">        for (int c = 0; c &lt; classCount; c++) {</span>
<span class="source-line-no">463</span><span id="line-463">            final int numberOfMethods = methodFlags[c].length;</span>
<span class="source-line-no">464</span><span id="line-464">            for (int m = 0; m &lt; numberOfMethods; m++) {</span>
<span class="source-line-no">465</span><span id="line-465">                final long methodFlag = methodFlags[c][m];</span>
<span class="source-line-no">466</span><span id="line-466">                if (!abstractModifier.matches(methodFlag) &amp;&amp; !nativeModifier.matches(methodFlag)) {</span>
<span class="source-line-no">467</span><span id="line-467">                    final int maxStack = codeMaxStack[i];</span>
<span class="source-line-no">468</span><span id="line-468">                    int maxLocal = codeMaxNALocals[i];</span>
<span class="source-line-no">469</span><span id="line-469">                    if (!staticModifier.matches(methodFlag)) {</span>
<span class="source-line-no">470</span><span id="line-470">                        maxLocal++; // one for 'this' parameter</span>
<span class="source-line-no">471</span><span id="line-471">                    }</span>
<span class="source-line-no">472</span><span id="line-472">                    // I believe this has to take wide arguments into account</span>
<span class="source-line-no">473</span><span id="line-473">                    maxLocal += SegmentUtils.countInvokeInterfaceArgs(methodDescr[c][m]);</span>
<span class="source-line-no">474</span><span id="line-474">                    final String[] cpClass = segment.getCpBands().getCpClass();</span>
<span class="source-line-no">475</span><span id="line-475">                    operandManager.setCurrentClass(cpClass[segment.getClassBands().getClassThisInts()[c]]);</span>
<span class="source-line-no">476</span><span id="line-476">                    operandManager.setSuperClass(cpClass[segment.getClassBands().getClassSuperInts()[c]]);</span>
<span class="source-line-no">477</span><span id="line-477">                    final List&lt;ExceptionTableEntry&gt; exceptionTable = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">478</span><span id="line-478">                    if (handlerCount != null) {</span>
<span class="source-line-no">479</span><span id="line-479">                        for (int j = 0; j &lt; handlerCount[i]; j++) {</span>
<span class="source-line-no">480</span><span id="line-480">                            final int handlerClass = handlerClassTypes[i][j] - 1;</span>
<span class="source-line-no">481</span><span id="line-481">                            CPClass cpHandlerClass = null;</span>
<span class="source-line-no">482</span><span id="line-482">                            if (handlerClass != -1) {</span>
<span class="source-line-no">483</span><span id="line-483">                                // The handlerClass will be null if the</span>
<span class="source-line-no">484</span><span id="line-484">                                // catch is a finally (that is, the</span>
<span class="source-line-no">485</span><span id="line-485">                                // exception table catch_type should be 0</span>
<span class="source-line-no">486</span><span id="line-486">                                cpHandlerClass = segment.getCpBands().cpClassValue(handlerClass);</span>
<span class="source-line-no">487</span><span id="line-487">                            }</span>
<span class="source-line-no">488</span><span id="line-488">                            final ExceptionTableEntry entry = new ExceptionTableEntry(handlerStartPCs[i][j], handlerEndPCs[i][j], handlerCatchPCs[i][j],</span>
<span class="source-line-no">489</span><span id="line-489">                                    cpHandlerClass);</span>
<span class="source-line-no">490</span><span id="line-490">                            exceptionTable.add(entry);</span>
<span class="source-line-no">491</span><span id="line-491">                        }</span>
<span class="source-line-no">492</span><span id="line-492">                    }</span>
<span class="source-line-no">493</span><span id="line-493">                    final CodeAttribute codeAttr = new CodeAttribute(maxStack, maxLocal, methodByteCodePacked[c][m], segment, operandManager, exceptionTable);</span>
<span class="source-line-no">494</span><span id="line-494">                    final List&lt;Attribute&gt; methodAttributesList = methodAttributes[c][m];</span>
<span class="source-line-no">495</span><span id="line-495">                    // Make sure we add the code attribute in the right place</span>
<span class="source-line-no">496</span><span id="line-496">                    int indexForCodeAttr = 0;</span>
<span class="source-line-no">497</span><span id="line-497">                    for (final Attribute attribute : methodAttributesList) {</span>
<span class="source-line-no">498</span><span id="line-498">                        if (!(attribute instanceof NewAttribute) || ((NewAttribute) attribute).getLayoutIndex() &gt;= 15) {</span>
<span class="source-line-no">499</span><span id="line-499">                            break;</span>
<span class="source-line-no">500</span><span id="line-500">                        }</span>
<span class="source-line-no">501</span><span id="line-501">                        indexForCodeAttr++;</span>
<span class="source-line-no">502</span><span id="line-502">                    }</span>
<span class="source-line-no">503</span><span id="line-503">                    methodAttributesList.add(indexForCodeAttr, codeAttr);</span>
<span class="source-line-no">504</span><span id="line-504">                    codeAttr.renumber(codeAttr.byteCodeOffsets);</span>
<span class="source-line-no">505</span><span id="line-505">                    List&lt;Attribute&gt; currentAttributes;</span>
<span class="source-line-no">506</span><span id="line-506">                    if (allCodeHasFlags) {</span>
<span class="source-line-no">507</span><span id="line-507">                        currentAttributes = orderedCodeAttributes.get(i);</span>
<span class="source-line-no">508</span><span id="line-508">                    } else if (codeHasFlags[i]) {</span>
<span class="source-line-no">509</span><span id="line-509">                        currentAttributes = orderedCodeAttributes.get(codeAttributeIndex);</span>
<span class="source-line-no">510</span><span id="line-510">                        codeAttributeIndex++;</span>
<span class="source-line-no">511</span><span id="line-511">                    } else {</span>
<span class="source-line-no">512</span><span id="line-512">                        currentAttributes = Collections.EMPTY_LIST;</span>
<span class="source-line-no">513</span><span id="line-513">                    }</span>
<span class="source-line-no">514</span><span id="line-514">                    for (final Attribute currentAttribute : currentAttributes) {</span>
<span class="source-line-no">515</span><span id="line-515">                        codeAttr.addAttribute(currentAttribute);</span>
<span class="source-line-no">516</span><span id="line-516">                        // Fix up the line numbers if needed</span>
<span class="source-line-no">517</span><span id="line-517">                        if (currentAttribute.hasBCIRenumbering()) {</span>
<span class="source-line-no">518</span><span id="line-518">                            ((BCIRenumberedAttribute) currentAttribute).renumber(codeAttr.byteCodeOffsets);</span>
<span class="source-line-no">519</span><span id="line-519">                        }</span>
<span class="source-line-no">520</span><span id="line-520">                    }</span>
<span class="source-line-no">521</span><span id="line-521">                    i++;</span>
<span class="source-line-no">522</span><span id="line-522">                }</span>
<span class="source-line-no">523</span><span id="line-523">            }</span>
<span class="source-line-no">524</span><span id="line-524">        }</span>
<span class="source-line-no">525</span><span id="line-525">    }</span>
<span class="source-line-no">526</span><span id="line-526">}</span>




























































</pre>
</div>
</main>
</body>
</html>
