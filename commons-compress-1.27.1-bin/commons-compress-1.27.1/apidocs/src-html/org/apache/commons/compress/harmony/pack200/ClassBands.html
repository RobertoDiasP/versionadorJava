<!DOCTYPE HTML>
<html lang>
<head>
<!-- Generated by javadoc (17) -->
<title>Source code</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="source: package: org.apache.commons.compress.harmony.pack200, class: ClassBands">
<meta name="generator" content="javadoc/SourceToHTMLConverter">
<link rel="stylesheet" type="text/css" href="../../../../../../../stylesheet.css" title="Style">
</head>
<body class="source-page">
<main role="main">
<div class="source-container">
<pre><span class="source-line-no">001</span><span id="line-1">/*</span>
<span class="source-line-no">002</span><span id="line-2"> *  Licensed to the Apache Software Foundation (ASF) under one or more</span>
<span class="source-line-no">003</span><span id="line-3"> *  contributor license agreements.  See the NOTICE file distributed with</span>
<span class="source-line-no">004</span><span id="line-4"> *  this work for additional information regarding copyright ownership.</span>
<span class="source-line-no">005</span><span id="line-5"> *  The ASF licenses this file to You under the Apache License, Version 2.0</span>
<span class="source-line-no">006</span><span id="line-6"> *  (the "License"); you may not use this file except in compliance with</span>
<span class="source-line-no">007</span><span id="line-7"> *  the License.  You may obtain a copy of the License at</span>
<span class="source-line-no">008</span><span id="line-8"> *</span>
<span class="source-line-no">009</span><span id="line-9"> *     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="source-line-no">010</span><span id="line-10"> *</span>
<span class="source-line-no">011</span><span id="line-11"> *  Unless required by applicable law or agreed to in writing, software</span>
<span class="source-line-no">012</span><span id="line-12"> *  distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="source-line-no">013</span><span id="line-13"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="source-line-no">014</span><span id="line-14"> *  See the License for the specific language governing permissions and</span>
<span class="source-line-no">015</span><span id="line-15"> *  limitations under the License.</span>
<span class="source-line-no">016</span><span id="line-16"> */</span>
<span class="source-line-no">017</span><span id="line-17">package org.apache.commons.compress.harmony.pack200;</span>
<span class="source-line-no">018</span><span id="line-18"></span>
<span class="source-line-no">019</span><span id="line-19">import java.io.IOException;</span>
<span class="source-line-no">020</span><span id="line-20">import java.io.OutputStream;</span>
<span class="source-line-no">021</span><span id="line-21">import java.util.ArrayList;</span>
<span class="source-line-no">022</span><span id="line-22">import java.util.Arrays;</span>
<span class="source-line-no">023</span><span id="line-23">import java.util.Comparator;</span>
<span class="source-line-no">024</span><span id="line-24">import java.util.HashMap;</span>
<span class="source-line-no">025</span><span id="line-25">import java.util.HashSet;</span>
<span class="source-line-no">026</span><span id="line-26">import java.util.List;</span>
<span class="source-line-no">027</span><span id="line-27">import java.util.Map;</span>
<span class="source-line-no">028</span><span id="line-28">import java.util.Set;</span>
<span class="source-line-no">029</span><span id="line-29"></span>
<span class="source-line-no">030</span><span id="line-30">import org.apache.commons.compress.harmony.pack200.AttributeDefinitionBands.AttributeDefinition;</span>
<span class="source-line-no">031</span><span id="line-31">import org.apache.commons.compress.harmony.pack200.IcBands.IcTuple;</span>
<span class="source-line-no">032</span><span id="line-32">import org.objectweb.asm.Label;</span>
<span class="source-line-no">033</span><span id="line-33">import org.objectweb.asm.Opcodes;</span>
<span class="source-line-no">034</span><span id="line-34"></span>
<span class="source-line-no">035</span><span id="line-35">/**</span>
<span class="source-line-no">036</span><span id="line-36"> * Class bands (corresponds to the {@code class_bands} set of bands in the pack200 specification)</span>
<span class="source-line-no">037</span><span id="line-37"> */</span>
<span class="source-line-no">038</span><span id="line-38">public class ClassBands extends BandSet {</span>
<span class="source-line-no">039</span><span id="line-39"></span>
<span class="source-line-no">040</span><span id="line-40">    private static final class TempParamAnnotation {</span>
<span class="source-line-no">041</span><span id="line-41"></span>
<span class="source-line-no">042</span><span id="line-42">        int numParams;</span>
<span class="source-line-no">043</span><span id="line-43">        int[] annoN;</span>
<span class="source-line-no">044</span><span id="line-44">        IntList pairN = new IntList();</span>
<span class="source-line-no">045</span><span id="line-45">        List&lt;String&gt; typeRS = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">046</span><span id="line-46">        List&lt;String&gt; nameRU = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">047</span><span id="line-47">        List&lt;String&gt; tags = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">048</span><span id="line-48">        List&lt;Object&gt; values = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">049</span><span id="line-49">        List&lt;Integer&gt; caseArrayN = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">050</span><span id="line-50">        List&lt;String&gt; nestTypeRS = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">051</span><span id="line-51">        List&lt;String&gt; nestNameRU = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">052</span><span id="line-52">        List&lt;Integer&gt; nestPairN = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">053</span><span id="line-53"></span>
<span class="source-line-no">054</span><span id="line-54">        TempParamAnnotation(final int numParams) {</span>
<span class="source-line-no">055</span><span id="line-55">            this.numParams = numParams;</span>
<span class="source-line-no">056</span><span id="line-56">            annoN = new int[numParams];</span>
<span class="source-line-no">057</span><span id="line-57">        }</span>
<span class="source-line-no">058</span><span id="line-58"></span>
<span class="source-line-no">059</span><span id="line-59">        void addParameterAnnotation(final int parameter, final String desc, final List&lt;String&gt; nameRU, final List&lt;String&gt; tags,</span>
<span class="source-line-no">060</span><span id="line-60">                final List&lt;Object&gt; values, final List&lt;Integer&gt; caseArrayN, final List&lt;String&gt; nestTypeRS, final List&lt;String&gt; nestNameRU,</span>
<span class="source-line-no">061</span><span id="line-61">                final List&lt;Integer&gt; nestPairN) {</span>
<span class="source-line-no">062</span><span id="line-62">            annoN[parameter]++;</span>
<span class="source-line-no">063</span><span id="line-63">            typeRS.add(desc);</span>
<span class="source-line-no">064</span><span id="line-64">            pairN.add(nameRU.size());</span>
<span class="source-line-no">065</span><span id="line-65">            this.nameRU.addAll(nameRU);</span>
<span class="source-line-no">066</span><span id="line-66">            this.tags.addAll(tags);</span>
<span class="source-line-no">067</span><span id="line-67">            this.values.addAll(values);</span>
<span class="source-line-no">068</span><span id="line-68">            this.caseArrayN.addAll(caseArrayN);</span>
<span class="source-line-no">069</span><span id="line-69">            this.nestTypeRS.addAll(nestTypeRS);</span>
<span class="source-line-no">070</span><span id="line-70">            this.nestNameRU.addAll(nestNameRU);</span>
<span class="source-line-no">071</span><span id="line-71">            this.nestPairN.addAll(nestPairN);</span>
<span class="source-line-no">072</span><span id="line-72">        }</span>
<span class="source-line-no">073</span><span id="line-73">    }</span>
<span class="source-line-no">074</span><span id="line-74"></span>
<span class="source-line-no">075</span><span id="line-75">    private static final long[] EMPTY_LONG_ARRAY = {};</span>
<span class="source-line-no">076</span><span id="line-76"></span>
<span class="source-line-no">077</span><span id="line-77">    protected static int countArgs(final String descriptor) {</span>
<span class="source-line-no">078</span><span id="line-78">        final int bra = descriptor.indexOf('(');</span>
<span class="source-line-no">079</span><span id="line-79">        final int ket = descriptor.indexOf(')');</span>
<span class="source-line-no">080</span><span id="line-80">        if (bra == -1 || ket == -1 || ket &lt; bra) {</span>
<span class="source-line-no">081</span><span id="line-81">            throw new IllegalArgumentException("No arguments");</span>
<span class="source-line-no">082</span><span id="line-82">        }</span>
<span class="source-line-no">083</span><span id="line-83"></span>
<span class="source-line-no">084</span><span id="line-84">        boolean inType = false;</span>
<span class="source-line-no">085</span><span id="line-85">        boolean consumingNextType = false;</span>
<span class="source-line-no">086</span><span id="line-86">        int count = 0;</span>
<span class="source-line-no">087</span><span id="line-87">        for (int i = bra + 1; i &lt; ket; i++) {</span>
<span class="source-line-no">088</span><span id="line-88">            final char charAt = descriptor.charAt(i);</span>
<span class="source-line-no">089</span><span id="line-89">            if (inType &amp;&amp; charAt == ';') {</span>
<span class="source-line-no">090</span><span id="line-90">                inType = false;</span>
<span class="source-line-no">091</span><span id="line-91">                consumingNextType = false;</span>
<span class="source-line-no">092</span><span id="line-92">            } else if (!inType &amp;&amp; charAt == 'L') {</span>
<span class="source-line-no">093</span><span id="line-93">                inType = true;</span>
<span class="source-line-no">094</span><span id="line-94">                count++;</span>
<span class="source-line-no">095</span><span id="line-95">            } else if (charAt == '[') {</span>
<span class="source-line-no">096</span><span id="line-96">                consumingNextType = true;</span>
<span class="source-line-no">097</span><span id="line-97">            } else if (inType) {</span>
<span class="source-line-no">098</span><span id="line-98">                // NOP</span>
<span class="source-line-no">099</span><span id="line-99">            } else if (consumingNextType) {</span>
<span class="source-line-no">100</span><span id="line-100">                count++;</span>
<span class="source-line-no">101</span><span id="line-101">                consumingNextType = false;</span>
<span class="source-line-no">102</span><span id="line-102">            } else if (charAt == 'D' || charAt == 'J') {</span>
<span class="source-line-no">103</span><span id="line-103">                count += 2;</span>
<span class="source-line-no">104</span><span id="line-104">            } else {</span>
<span class="source-line-no">105</span><span id="line-105">                count++;</span>
<span class="source-line-no">106</span><span id="line-106">            }</span>
<span class="source-line-no">107</span><span id="line-107">        }</span>
<span class="source-line-no">108</span><span id="line-108">        return count;</span>
<span class="source-line-no">109</span><span id="line-109">    }</span>
<span class="source-line-no">110</span><span id="line-110"></span>
<span class="source-line-no">111</span><span id="line-111">    private final CpBands cpBands;</span>
<span class="source-line-no">112</span><span id="line-112">    private final AttributeDefinitionBands attrBands;</span>
<span class="source-line-no">113</span><span id="line-113">    private final CPClass[] class_this;</span>
<span class="source-line-no">114</span><span id="line-114">    private final CPClass[] class_super;</span>
<span class="source-line-no">115</span><span id="line-115"></span>
<span class="source-line-no">116</span><span id="line-116">    private final CPClass[][] class_interface;</span>
<span class="source-line-no">117</span><span id="line-117"></span>
<span class="source-line-no">118</span><span id="line-118">    private final int[] class_interface_count;</span>
<span class="source-line-no">119</span><span id="line-119">    private final int[] major_versions;</span>
<span class="source-line-no">120</span><span id="line-120">    private final long[] class_flags;</span>
<span class="source-line-no">121</span><span id="line-121">    private int[] class_attr_calls;</span>
<span class="source-line-no">122</span><span id="line-122">    private final List&lt;CPUTF8&gt; classSourceFile = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">123</span><span id="line-123">    private final List&lt;ConstantPoolEntry&gt; classEnclosingMethodClass = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">124</span><span id="line-124"></span>
<span class="source-line-no">125</span><span id="line-125">    private final List&lt;ConstantPoolEntry&gt; classEnclosingMethodDesc = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">126</span><span id="line-126">    private final List&lt;CPSignature&gt; classSignature = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">127</span><span id="line-127"></span>
<span class="source-line-no">128</span><span id="line-128">    private final IntList classFileVersionMinor = new IntList();</span>
<span class="source-line-no">129</span><span id="line-129">    private final IntList classFileVersionMajor = new IntList();</span>
<span class="source-line-no">130</span><span id="line-130">    private final int[] class_field_count;</span>
<span class="source-line-no">131</span><span id="line-131">    private final CPNameAndType[][] field_descr;</span>
<span class="source-line-no">132</span><span id="line-132">    private final long[][] field_flags;</span>
<span class="source-line-no">133</span><span id="line-133">    private int[] field_attr_calls;</span>
<span class="source-line-no">134</span><span id="line-134"></span>
<span class="source-line-no">135</span><span id="line-135">    private final List&lt;CPConstant&lt;?&gt;&gt; fieldConstantValueKQ = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">136</span><span id="line-136">    private final List&lt;CPSignature&gt; fieldSignature = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">137</span><span id="line-137">    private final int[] class_method_count;</span>
<span class="source-line-no">138</span><span id="line-138">    private final CPNameAndType[][] method_descr;</span>
<span class="source-line-no">139</span><span id="line-139">    private final long[][] method_flags;</span>
<span class="source-line-no">140</span><span id="line-140">    private int[] method_attr_calls;</span>
<span class="source-line-no">141</span><span id="line-141">    private final List&lt;CPSignature&gt; methodSignature = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">142</span><span id="line-142"></span>
<span class="source-line-no">143</span><span id="line-143">    private final IntList methodExceptionNumber = new IntList();</span>
<span class="source-line-no">144</span><span id="line-144">    private final List&lt;CPClass&gt; methodExceptionClasses = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">145</span><span id="line-145">    private int[] codeHeaders;</span>
<span class="source-line-no">146</span><span id="line-146">    private final IntList codeMaxStack = new IntList();</span>
<span class="source-line-no">147</span><span id="line-147">    private final IntList codeMaxLocals = new IntList();</span>
<span class="source-line-no">148</span><span id="line-148">    private final IntList codeHandlerCount = new IntList();</span>
<span class="source-line-no">149</span><span id="line-149">    private final List codeHandlerStartP = new ArrayList();</span>
<span class="source-line-no">150</span><span id="line-150">    private final List codeHandlerEndPO = new ArrayList();</span>
<span class="source-line-no">151</span><span id="line-151">    private final List codeHandlerCatchPO = new ArrayList();</span>
<span class="source-line-no">152</span><span id="line-152">    private final List&lt;CPClass&gt; codeHandlerClass = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">153</span><span id="line-153">    private final List&lt;Long&gt; codeFlags = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">154</span><span id="line-154">    private int[] code_attr_calls;</span>
<span class="source-line-no">155</span><span id="line-155">    private final IntList codeLineNumberTableN = new IntList();</span>
<span class="source-line-no">156</span><span id="line-156">    private final List codeLineNumberTableBciP = new ArrayList();</span>
<span class="source-line-no">157</span><span id="line-157">    private final IntList codeLineNumberTableLine = new IntList();</span>
<span class="source-line-no">158</span><span id="line-158">    private final IntList codeLocalVariableTableN = new IntList();</span>
<span class="source-line-no">159</span><span id="line-159">    private final List codeLocalVariableTableBciP = new ArrayList();</span>
<span class="source-line-no">160</span><span id="line-160">    private final List codeLocalVariableTableSpanO = new ArrayList();</span>
<span class="source-line-no">161</span><span id="line-161">    private final List&lt;ConstantPoolEntry&gt; codeLocalVariableTableNameRU = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">162</span><span id="line-162">    private final List&lt;ConstantPoolEntry&gt; codeLocalVariableTableTypeRS = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">163</span><span id="line-163">    private final IntList codeLocalVariableTableSlot = new IntList();</span>
<span class="source-line-no">164</span><span id="line-164">    private final IntList codeLocalVariableTypeTableN = new IntList();</span>
<span class="source-line-no">165</span><span id="line-165">    private final List codeLocalVariableTypeTableBciP = new ArrayList();</span>
<span class="source-line-no">166</span><span id="line-166">    private final List codeLocalVariableTypeTableSpanO = new ArrayList();</span>
<span class="source-line-no">167</span><span id="line-167">    private final List&lt;ConstantPoolEntry&gt; codeLocalVariableTypeTableNameRU = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">168</span><span id="line-168"></span>
<span class="source-line-no">169</span><span id="line-169">    private final List&lt;ConstantPoolEntry&gt; codeLocalVariableTypeTableTypeRS = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">170</span><span id="line-170">    private final IntList codeLocalVariableTypeTableSlot = new IntList();</span>
<span class="source-line-no">171</span><span id="line-171">    private final MetadataBandGroup class_RVA_bands;</span>
<span class="source-line-no">172</span><span id="line-172">    private final MetadataBandGroup class_RIA_bands;</span>
<span class="source-line-no">173</span><span id="line-173">    private final MetadataBandGroup field_RVA_bands;</span>
<span class="source-line-no">174</span><span id="line-174">    private final MetadataBandGroup field_RIA_bands;</span>
<span class="source-line-no">175</span><span id="line-175">    private final MetadataBandGroup method_RVA_bands;</span>
<span class="source-line-no">176</span><span id="line-176">    private final MetadataBandGroup method_RIA_bands;</span>
<span class="source-line-no">177</span><span id="line-177">    private final MetadataBandGroup method_RVPA_bands;</span>
<span class="source-line-no">178</span><span id="line-178"></span>
<span class="source-line-no">179</span><span id="line-179">    private final MetadataBandGroup method_RIPA_bands;</span>
<span class="source-line-no">180</span><span id="line-180">    private final MetadataBandGroup method_AD_bands;</span>
<span class="source-line-no">181</span><span id="line-181">    private final List&lt;NewAttributeBands&gt; classAttributeBands = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">182</span><span id="line-182">    private final List&lt;NewAttributeBands&gt; methodAttributeBands = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">183</span><span id="line-183"></span>
<span class="source-line-no">184</span><span id="line-184">    private final List&lt;NewAttributeBands&gt; fieldAttributeBands = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">185</span><span id="line-185">    private final List&lt;NewAttributeBands&gt; codeAttributeBands = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">186</span><span id="line-186">    private final List&lt;Long&gt; tempFieldFlags = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">187</span><span id="line-187">    private final List&lt;CPNameAndType&gt; tempFieldDesc = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">188</span><span id="line-188">    private final List&lt;Long&gt; tempMethodFlags = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">189</span><span id="line-189">    private final List&lt;CPNameAndType&gt; tempMethodDesc = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">190</span><span id="line-190"></span>
<span class="source-line-no">191</span><span id="line-191">    private TempParamAnnotation tempMethodRVPA;</span>
<span class="source-line-no">192</span><span id="line-192">    private TempParamAnnotation tempMethodRIPA;</span>
<span class="source-line-no">193</span><span id="line-193">    private boolean anySyntheticClasses;</span>
<span class="source-line-no">194</span><span id="line-194">    private boolean anySyntheticFields;</span>
<span class="source-line-no">195</span><span id="line-195"></span>
<span class="source-line-no">196</span><span id="line-196">    private boolean anySyntheticMethods;</span>
<span class="source-line-no">197</span><span id="line-197">    private final Segment segment;</span>
<span class="source-line-no">198</span><span id="line-198"></span>
<span class="source-line-no">199</span><span id="line-199">    private final Map&lt;CPClass, Set&lt;CPClass&gt;&gt; classReferencesInnerClass = new HashMap&lt;&gt;();</span>
<span class="source-line-no">200</span><span id="line-200"></span>
<span class="source-line-no">201</span><span id="line-201">    private final boolean stripDebug;</span>
<span class="source-line-no">202</span><span id="line-202">    private int index;</span>
<span class="source-line-no">203</span><span id="line-203">    private int numMethodArgs;</span>
<span class="source-line-no">204</span><span id="line-204">    private int[] class_InnerClasses_N;</span>
<span class="source-line-no">205</span><span id="line-205">    private CPClass[] class_InnerClasses_RC;</span>
<span class="source-line-no">206</span><span id="line-206">    private int[] class_InnerClasses_F;</span>
<span class="source-line-no">207</span><span id="line-207"></span>
<span class="source-line-no">208</span><span id="line-208">    private List&lt;CPClass&gt; classInnerClassesOuterRCN;</span>
<span class="source-line-no">209</span><span id="line-209"></span>
<span class="source-line-no">210</span><span id="line-210">    private List&lt;CPUTF8&gt; classInnerClassesNameRUN;</span>
<span class="source-line-no">211</span><span id="line-211"></span>
<span class="source-line-no">212</span><span id="line-212">    public ClassBands(final Segment segment, final int numClasses, final int effort, final boolean stripDebug) throws IOException {</span>
<span class="source-line-no">213</span><span id="line-213">        super(effort, segment.getSegmentHeader());</span>
<span class="source-line-no">214</span><span id="line-214">        this.stripDebug = stripDebug;</span>
<span class="source-line-no">215</span><span id="line-215">        this.segment = segment;</span>
<span class="source-line-no">216</span><span id="line-216">        this.cpBands = segment.getCpBands();</span>
<span class="source-line-no">217</span><span id="line-217">        this.attrBands = segment.getAttrBands();</span>
<span class="source-line-no">218</span><span id="line-218">        class_this = new CPClass[numClasses];</span>
<span class="source-line-no">219</span><span id="line-219">        class_super = new CPClass[numClasses];</span>
<span class="source-line-no">220</span><span id="line-220">        class_interface_count = new int[numClasses];</span>
<span class="source-line-no">221</span><span id="line-221">        class_interface = new CPClass[numClasses][];</span>
<span class="source-line-no">222</span><span id="line-222">        class_field_count = new int[numClasses];</span>
<span class="source-line-no">223</span><span id="line-223">        class_method_count = new int[numClasses];</span>
<span class="source-line-no">224</span><span id="line-224">        field_descr = new CPNameAndType[numClasses][];</span>
<span class="source-line-no">225</span><span id="line-225">        field_flags = new long[numClasses][];</span>
<span class="source-line-no">226</span><span id="line-226">        method_descr = new CPNameAndType[numClasses][];</span>
<span class="source-line-no">227</span><span id="line-227">        method_flags = new long[numClasses][];</span>
<span class="source-line-no">228</span><span id="line-228">        for (int i = 0; i &lt; numClasses; i++) {</span>
<span class="source-line-no">229</span><span id="line-229">            field_flags[i] = EMPTY_LONG_ARRAY;</span>
<span class="source-line-no">230</span><span id="line-230">            method_flags[i] = EMPTY_LONG_ARRAY;</span>
<span class="source-line-no">231</span><span id="line-231">        }</span>
<span class="source-line-no">232</span><span id="line-232">        // minor_versions = new int[numClasses];</span>
<span class="source-line-no">233</span><span id="line-233">        major_versions = new int[numClasses];</span>
<span class="source-line-no">234</span><span id="line-234">        class_flags = new long[numClasses];</span>
<span class="source-line-no">235</span><span id="line-235"></span>
<span class="source-line-no">236</span><span id="line-236">        class_RVA_bands = new MetadataBandGroup("RVA", MetadataBandGroup.CONTEXT_CLASS, cpBands, segmentHeader, effort);</span>
<span class="source-line-no">237</span><span id="line-237">        class_RIA_bands = new MetadataBandGroup("RIA", MetadataBandGroup.CONTEXT_CLASS, cpBands, segmentHeader, effort);</span>
<span class="source-line-no">238</span><span id="line-238">        field_RVA_bands = new MetadataBandGroup("RVA", MetadataBandGroup.CONTEXT_FIELD, cpBands, segmentHeader, effort);</span>
<span class="source-line-no">239</span><span id="line-239">        field_RIA_bands = new MetadataBandGroup("RIA", MetadataBandGroup.CONTEXT_FIELD, cpBands, segmentHeader, effort);</span>
<span class="source-line-no">240</span><span id="line-240">        method_RVA_bands = new MetadataBandGroup("RVA", MetadataBandGroup.CONTEXT_METHOD, cpBands, segmentHeader, effort);</span>
<span class="source-line-no">241</span><span id="line-241">        method_RIA_bands = new MetadataBandGroup("RIA", MetadataBandGroup.CONTEXT_METHOD, cpBands, segmentHeader, effort);</span>
<span class="source-line-no">242</span><span id="line-242">        method_RVPA_bands = new MetadataBandGroup("RVPA", MetadataBandGroup.CONTEXT_METHOD, cpBands, segmentHeader, effort);</span>
<span class="source-line-no">243</span><span id="line-243">        method_RIPA_bands = new MetadataBandGroup("RIPA", MetadataBandGroup.CONTEXT_METHOD, cpBands, segmentHeader, effort);</span>
<span class="source-line-no">244</span><span id="line-244">        method_AD_bands = new MetadataBandGroup("AD", MetadataBandGroup.CONTEXT_METHOD, cpBands, segmentHeader, effort);</span>
<span class="source-line-no">245</span><span id="line-245"></span>
<span class="source-line-no">246</span><span id="line-246">        createNewAttributeBands();</span>
<span class="source-line-no">247</span><span id="line-247">    }</span>
<span class="source-line-no">248</span><span id="line-248"></span>
<span class="source-line-no">249</span><span id="line-249">    public void addAnnotation(final int context, final String desc, final boolean visible, final List&lt;String&gt; nameRU, final List&lt;String&gt; tags,</span>
<span class="source-line-no">250</span><span id="line-250">            final List&lt;Object&gt; values, final List&lt;Integer&gt; caseArrayN, final List&lt;String&gt; nestTypeRS, final List&lt;String&gt; nestNameRU,</span>
<span class="source-line-no">251</span><span id="line-251">            final List&lt;Integer&gt; nestPairN) {</span>
<span class="source-line-no">252</span><span id="line-252">        switch (context) {</span>
<span class="source-line-no">253</span><span id="line-253">        case MetadataBandGroup.CONTEXT_CLASS:</span>
<span class="source-line-no">254</span><span id="line-254">            if (visible) {</span>
<span class="source-line-no">255</span><span id="line-255">                class_RVA_bands.addAnnotation(desc, nameRU, tags, values, caseArrayN, nestTypeRS, nestNameRU, nestPairN);</span>
<span class="source-line-no">256</span><span id="line-256">                if ((class_flags[index] &amp; 1 &lt;&lt; 21) != 0) {</span>
<span class="source-line-no">257</span><span id="line-257">                    class_RVA_bands.incrementAnnoN();</span>
<span class="source-line-no">258</span><span id="line-258">                } else {</span>
<span class="source-line-no">259</span><span id="line-259">                    class_RVA_bands.newEntryInAnnoN();</span>
<span class="source-line-no">260</span><span id="line-260">                    class_flags[index] = class_flags[index] | 1 &lt;&lt; 21;</span>
<span class="source-line-no">261</span><span id="line-261">                }</span>
<span class="source-line-no">262</span><span id="line-262">            } else {</span>
<span class="source-line-no">263</span><span id="line-263">                class_RIA_bands.addAnnotation(desc, nameRU, tags, values, caseArrayN, nestTypeRS, nestNameRU, nestPairN);</span>
<span class="source-line-no">264</span><span id="line-264">                if ((class_flags[index] &amp; 1 &lt;&lt; 22) != 0) {</span>
<span class="source-line-no">265</span><span id="line-265">                    class_RIA_bands.incrementAnnoN();</span>
<span class="source-line-no">266</span><span id="line-266">                } else {</span>
<span class="source-line-no">267</span><span id="line-267">                    class_RIA_bands.newEntryInAnnoN();</span>
<span class="source-line-no">268</span><span id="line-268">                    class_flags[index] = class_flags[index] | 1 &lt;&lt; 22;</span>
<span class="source-line-no">269</span><span id="line-269">                }</span>
<span class="source-line-no">270</span><span id="line-270">            }</span>
<span class="source-line-no">271</span><span id="line-271">            break;</span>
<span class="source-line-no">272</span><span id="line-272">        case MetadataBandGroup.CONTEXT_FIELD:</span>
<span class="source-line-no">273</span><span id="line-273">            if (visible) {</span>
<span class="source-line-no">274</span><span id="line-274">                field_RVA_bands.addAnnotation(desc, nameRU, tags, values, caseArrayN, nestTypeRS, nestNameRU, nestPairN);</span>
<span class="source-line-no">275</span><span id="line-275">                final Long flag = tempFieldFlags.remove(tempFieldFlags.size() - 1);</span>
<span class="source-line-no">276</span><span id="line-276">                if ((flag.intValue() &amp; 1 &lt;&lt; 21) != 0) {</span>
<span class="source-line-no">277</span><span id="line-277">                    field_RVA_bands.incrementAnnoN();</span>
<span class="source-line-no">278</span><span id="line-278">                } else {</span>
<span class="source-line-no">279</span><span id="line-279">                    field_RVA_bands.newEntryInAnnoN();</span>
<span class="source-line-no">280</span><span id="line-280">                }</span>
<span class="source-line-no">281</span><span id="line-281">                tempFieldFlags.add(Long.valueOf(flag.intValue() | 1 &lt;&lt; 21));</span>
<span class="source-line-no">282</span><span id="line-282">            } else {</span>
<span class="source-line-no">283</span><span id="line-283">                field_RIA_bands.addAnnotation(desc, nameRU, tags, values, caseArrayN, nestTypeRS, nestNameRU, nestPairN);</span>
<span class="source-line-no">284</span><span id="line-284">                final Long flag = tempFieldFlags.remove(tempFieldFlags.size() - 1);</span>
<span class="source-line-no">285</span><span id="line-285">                if ((flag.intValue() &amp; 1 &lt;&lt; 22) != 0) {</span>
<span class="source-line-no">286</span><span id="line-286">                    field_RIA_bands.incrementAnnoN();</span>
<span class="source-line-no">287</span><span id="line-287">                } else {</span>
<span class="source-line-no">288</span><span id="line-288">                    field_RIA_bands.newEntryInAnnoN();</span>
<span class="source-line-no">289</span><span id="line-289">                }</span>
<span class="source-line-no">290</span><span id="line-290">                tempFieldFlags.add(Long.valueOf(flag.intValue() | 1 &lt;&lt; 22));</span>
<span class="source-line-no">291</span><span id="line-291">            }</span>
<span class="source-line-no">292</span><span id="line-292">            break;</span>
<span class="source-line-no">293</span><span id="line-293">        case MetadataBandGroup.CONTEXT_METHOD:</span>
<span class="source-line-no">294</span><span id="line-294">            if (visible) {</span>
<span class="source-line-no">295</span><span id="line-295">                method_RVA_bands.addAnnotation(desc, nameRU, tags, values, caseArrayN, nestTypeRS, nestNameRU, nestPairN);</span>
<span class="source-line-no">296</span><span id="line-296">                final Long flag = tempMethodFlags.remove(tempMethodFlags.size() - 1);</span>
<span class="source-line-no">297</span><span id="line-297">                if ((flag.intValue() &amp; 1 &lt;&lt; 21) != 0) {</span>
<span class="source-line-no">298</span><span id="line-298">                    method_RVA_bands.incrementAnnoN();</span>
<span class="source-line-no">299</span><span id="line-299">                } else {</span>
<span class="source-line-no">300</span><span id="line-300">                    method_RVA_bands.newEntryInAnnoN();</span>
<span class="source-line-no">301</span><span id="line-301">                }</span>
<span class="source-line-no">302</span><span id="line-302">                tempMethodFlags.add(Long.valueOf(flag.intValue() | 1 &lt;&lt; 21));</span>
<span class="source-line-no">303</span><span id="line-303">            } else {</span>
<span class="source-line-no">304</span><span id="line-304">                method_RIA_bands.addAnnotation(desc, nameRU, tags, values, caseArrayN, nestTypeRS, nestNameRU, nestPairN);</span>
<span class="source-line-no">305</span><span id="line-305">                final Long flag = tempMethodFlags.remove(tempMethodFlags.size() - 1);</span>
<span class="source-line-no">306</span><span id="line-306">                if ((flag.intValue() &amp; 1 &lt;&lt; 22) != 0) {</span>
<span class="source-line-no">307</span><span id="line-307">                    method_RIA_bands.incrementAnnoN();</span>
<span class="source-line-no">308</span><span id="line-308">                } else {</span>
<span class="source-line-no">309</span><span id="line-309">                    method_RIA_bands.newEntryInAnnoN();</span>
<span class="source-line-no">310</span><span id="line-310">                }</span>
<span class="source-line-no">311</span><span id="line-311">                tempMethodFlags.add(Long.valueOf(flag.intValue() | 1 &lt;&lt; 22));</span>
<span class="source-line-no">312</span><span id="line-312">            }</span>
<span class="source-line-no">313</span><span id="line-313">            break;</span>
<span class="source-line-no">314</span><span id="line-314">        }</span>
<span class="source-line-no">315</span><span id="line-315">    }</span>
<span class="source-line-no">316</span><span id="line-316"></span>
<span class="source-line-no">317</span><span id="line-317">    public void addAnnotationDefault(final List&lt;String&gt; nameRU, final List&lt;String&gt; tags, final List&lt;Object&gt; values, final List&lt;Integer&gt; caseArrayN,</span>
<span class="source-line-no">318</span><span id="line-318">            final List&lt;String&gt; nestTypeRS, final List&lt;String&gt; nestNameRU, final List&lt;Integer&gt; nestPairN) {</span>
<span class="source-line-no">319</span><span id="line-319">        method_AD_bands.addAnnotation(null, nameRU, tags, values, caseArrayN, nestTypeRS, nestNameRU, nestPairN);</span>
<span class="source-line-no">320</span><span id="line-320">        final Long flag = tempMethodFlags.remove(tempMethodFlags.size() - 1);</span>
<span class="source-line-no">321</span><span id="line-321">        tempMethodFlags.add(Long.valueOf(flag.longValue() | 1 &lt;&lt; 25));</span>
<span class="source-line-no">322</span><span id="line-322">    }</span>
<span class="source-line-no">323</span><span id="line-323"></span>
<span class="source-line-no">324</span><span id="line-324">    public void addClass(final int major, final int flags, final String className, final String signature, final String superName, final String[] interfaces) {</span>
<span class="source-line-no">325</span><span id="line-325">        class_this[index] = cpBands.getCPClass(className);</span>
<span class="source-line-no">326</span><span id="line-326">        class_super[index] = cpBands.getCPClass(superName);</span>
<span class="source-line-no">327</span><span id="line-327">        class_interface_count[index] = interfaces.length;</span>
<span class="source-line-no">328</span><span id="line-328">        class_interface[index] = new CPClass[interfaces.length];</span>
<span class="source-line-no">329</span><span id="line-329">        Arrays.setAll(class_interface[index], i -&gt; cpBands.getCPClass(interfaces[i]));</span>
<span class="source-line-no">330</span><span id="line-330">        major_versions[index] = major;</span>
<span class="source-line-no">331</span><span id="line-331">        class_flags[index] = flags;</span>
<span class="source-line-no">332</span><span id="line-332">        if (!anySyntheticClasses &amp;&amp; (flags &amp; 1 &lt;&lt; 12) != 0 &amp;&amp; segment.getCurrentClassReader().hasSyntheticAttributes()) {</span>
<span class="source-line-no">333</span><span id="line-333">            cpBands.addCPUtf8("Synthetic");</span>
<span class="source-line-no">334</span><span id="line-334">            anySyntheticClasses = true;</span>
<span class="source-line-no">335</span><span id="line-335">        }</span>
<span class="source-line-no">336</span><span id="line-336">//        if ((flags &amp; Opcodes.ACC_DEPRECATED) != 0) { // ASM uses (1&lt;&lt;17) flag for deprecated</span>
<span class="source-line-no">337</span><span id="line-337">//            flags &amp;= ~Opcodes.ACC_DEPRECATED;</span>
<span class="source-line-no">338</span><span id="line-338">//            flags |= (1 &lt;&lt; 20);</span>
<span class="source-line-no">339</span><span id="line-339">//        }</span>
<span class="source-line-no">340</span><span id="line-340">        if (signature != null) {</span>
<span class="source-line-no">341</span><span id="line-341">            class_flags[index] |= 1 &lt;&lt; 19;</span>
<span class="source-line-no">342</span><span id="line-342">            classSignature.add(cpBands.getCPSignature(signature));</span>
<span class="source-line-no">343</span><span id="line-343">        }</span>
<span class="source-line-no">344</span><span id="line-344">    }</span>
<span class="source-line-no">345</span><span id="line-345"></span>
<span class="source-line-no">346</span><span id="line-346">    public void addClassAttribute(final NewAttribute attribute) {</span>
<span class="source-line-no">347</span><span id="line-347">        // TODO: backwards calls</span>
<span class="source-line-no">348</span><span id="line-348">        final String attributeName = attribute.type;</span>
<span class="source-line-no">349</span><span id="line-349">        for (final NewAttributeBands bands : classAttributeBands) {</span>
<span class="source-line-no">350</span><span id="line-350">            if (bands.getAttributeName().equals(attributeName)) {</span>
<span class="source-line-no">351</span><span id="line-351">                bands.addAttribute(attribute);</span>
<span class="source-line-no">352</span><span id="line-352">                final int flagIndex = bands.getFlagIndex();</span>
<span class="source-line-no">353</span><span id="line-353">                class_flags[index] |= 1 &lt;&lt; flagIndex;</span>
<span class="source-line-no">354</span><span id="line-354">                return;</span>
<span class="source-line-no">355</span><span id="line-355">            }</span>
<span class="source-line-no">356</span><span id="line-356">        }</span>
<span class="source-line-no">357</span><span id="line-357">        throw new IllegalArgumentException("No suitable definition for " + attributeName);</span>
<span class="source-line-no">358</span><span id="line-358">    }</span>
<span class="source-line-no">359</span><span id="line-359"></span>
<span class="source-line-no">360</span><span id="line-360">    public void addCode() {</span>
<span class="source-line-no">361</span><span id="line-361">        codeHandlerCount.add(0);</span>
<span class="source-line-no">362</span><span id="line-362">        if (!stripDebug) {</span>
<span class="source-line-no">363</span><span id="line-363">            codeFlags.add(Long.valueOf(1 &lt;&lt; 2));</span>
<span class="source-line-no">364</span><span id="line-364">            codeLocalVariableTableN.add(0);</span>
<span class="source-line-no">365</span><span id="line-365">        }</span>
<span class="source-line-no">366</span><span id="line-366">    }</span>
<span class="source-line-no">367</span><span id="line-367"></span>
<span class="source-line-no">368</span><span id="line-368">    public void addCodeAttribute(final NewAttribute attribute) {</span>
<span class="source-line-no">369</span><span id="line-369">        final String attributeName = attribute.type;</span>
<span class="source-line-no">370</span><span id="line-370">        for (final NewAttributeBands bands : codeAttributeBands) {</span>
<span class="source-line-no">371</span><span id="line-371">            if (bands.getAttributeName().equals(attributeName)) {</span>
<span class="source-line-no">372</span><span id="line-372">                bands.addAttribute(attribute);</span>
<span class="source-line-no">373</span><span id="line-373">                final int flagIndex = bands.getFlagIndex();</span>
<span class="source-line-no">374</span><span id="line-374">                final Long flags = codeFlags.remove(codeFlags.size() - 1);</span>
<span class="source-line-no">375</span><span id="line-375">                codeFlags.add(Long.valueOf(flags.longValue() | 1 &lt;&lt; flagIndex));</span>
<span class="source-line-no">376</span><span id="line-376">                return;</span>
<span class="source-line-no">377</span><span id="line-377">            }</span>
<span class="source-line-no">378</span><span id="line-378">        }</span>
<span class="source-line-no">379</span><span id="line-379">        throw new IllegalArgumentException("No suitable definition for " + attributeName);</span>
<span class="source-line-no">380</span><span id="line-380">    }</span>
<span class="source-line-no">381</span><span id="line-381"></span>
<span class="source-line-no">382</span><span id="line-382">    public void addEnclosingMethod(final String owner, final String name, final String desc) {</span>
<span class="source-line-no">383</span><span id="line-383">        class_flags[index] |= 1 &lt;&lt; 18;</span>
<span class="source-line-no">384</span><span id="line-384">        classEnclosingMethodClass.add(cpBands.getCPClass(owner));</span>
<span class="source-line-no">385</span><span id="line-385">        classEnclosingMethodDesc.add(name == null ? null : cpBands.getCPNameAndType(name, desc));</span>
<span class="source-line-no">386</span><span id="line-386">    }</span>
<span class="source-line-no">387</span><span id="line-387"></span>
<span class="source-line-no">388</span><span id="line-388">    public void addField(int flags, final String name, final String desc, final String signature, final Object value) {</span>
<span class="source-line-no">389</span><span id="line-389">        flags &amp;= 0xFFFF;</span>
<span class="source-line-no">390</span><span id="line-390">        tempFieldDesc.add(cpBands.getCPNameAndType(name, desc));</span>
<span class="source-line-no">391</span><span id="line-391">        if (signature != null) {</span>
<span class="source-line-no">392</span><span id="line-392">            fieldSignature.add(cpBands.getCPSignature(signature));</span>
<span class="source-line-no">393</span><span id="line-393">            flags |= 1 &lt;&lt; 19;</span>
<span class="source-line-no">394</span><span id="line-394">        }</span>
<span class="source-line-no">395</span><span id="line-395">        if ((flags &amp; Opcodes.ACC_DEPRECATED) != 0) { // ASM uses (1&lt;&lt;17) flag for deprecated</span>
<span class="source-line-no">396</span><span id="line-396">            flags &amp;= ~Opcodes.ACC_DEPRECATED;</span>
<span class="source-line-no">397</span><span id="line-397">            flags |= 1 &lt;&lt; 20;</span>
<span class="source-line-no">398</span><span id="line-398">        }</span>
<span class="source-line-no">399</span><span id="line-399">        if (value != null) {</span>
<span class="source-line-no">400</span><span id="line-400">            fieldConstantValueKQ.add(cpBands.getConstant(value));</span>
<span class="source-line-no">401</span><span id="line-401">            flags |= 1 &lt;&lt; 17;</span>
<span class="source-line-no">402</span><span id="line-402">        }</span>
<span class="source-line-no">403</span><span id="line-403">        if (!anySyntheticFields &amp;&amp; (flags &amp; 1 &lt;&lt; 12) != 0 &amp;&amp; segment.getCurrentClassReader().hasSyntheticAttributes()) {</span>
<span class="source-line-no">404</span><span id="line-404">            cpBands.addCPUtf8("Synthetic");</span>
<span class="source-line-no">405</span><span id="line-405">            anySyntheticFields = true;</span>
<span class="source-line-no">406</span><span id="line-406">        }</span>
<span class="source-line-no">407</span><span id="line-407">        tempFieldFlags.add(Long.valueOf(flags));</span>
<span class="source-line-no">408</span><span id="line-408">    }</span>
<span class="source-line-no">409</span><span id="line-409"></span>
<span class="source-line-no">410</span><span id="line-410">    public void addFieldAttribute(final NewAttribute attribute) {</span>
<span class="source-line-no">411</span><span id="line-411">        final String attributeName = attribute.type;</span>
<span class="source-line-no">412</span><span id="line-412">        for (final NewAttributeBands bands : fieldAttributeBands) {</span>
<span class="source-line-no">413</span><span id="line-413">            if (bands.getAttributeName().equals(attributeName)) {</span>
<span class="source-line-no">414</span><span id="line-414">                bands.addAttribute(attribute);</span>
<span class="source-line-no">415</span><span id="line-415">                final int flagIndex = bands.getFlagIndex();</span>
<span class="source-line-no">416</span><span id="line-416">                final Long flags = tempFieldFlags.remove(tempFieldFlags.size() - 1);</span>
<span class="source-line-no">417</span><span id="line-417">                tempFieldFlags.add(Long.valueOf(flags.longValue() | 1 &lt;&lt; flagIndex));</span>
<span class="source-line-no">418</span><span id="line-418">                return;</span>
<span class="source-line-no">419</span><span id="line-419">            }</span>
<span class="source-line-no">420</span><span id="line-420">        }</span>
<span class="source-line-no">421</span><span id="line-421">        throw new IllegalArgumentException("No suitable definition for " + attributeName);</span>
<span class="source-line-no">422</span><span id="line-422">    }</span>
<span class="source-line-no">423</span><span id="line-423"></span>
<span class="source-line-no">424</span><span id="line-424">    public void addHandler(final Label start, final Label end, final Label handler, final String type) {</span>
<span class="source-line-no">425</span><span id="line-425">        final int handlers = codeHandlerCount.remove(codeHandlerCount.size() - 1);</span>
<span class="source-line-no">426</span><span id="line-426">        codeHandlerCount.add(handlers + 1);</span>
<span class="source-line-no">427</span><span id="line-427">        codeHandlerStartP.add(start);</span>
<span class="source-line-no">428</span><span id="line-428">        codeHandlerEndPO.add(end);</span>
<span class="source-line-no">429</span><span id="line-429">        codeHandlerCatchPO.add(handler);</span>
<span class="source-line-no">430</span><span id="line-430">        codeHandlerClass.add(type == null ? null : cpBands.getCPClass(type));</span>
<span class="source-line-no">431</span><span id="line-431">    }</span>
<span class="source-line-no">432</span><span id="line-432"></span>
<span class="source-line-no">433</span><span id="line-433">    public void addLineNumber(final int line, final Label start) {</span>
<span class="source-line-no">434</span><span id="line-434">        final Long latestCodeFlag = codeFlags.get(codeFlags.size() - 1);</span>
<span class="source-line-no">435</span><span id="line-435">        if ((latestCodeFlag.intValue() &amp; 1 &lt;&lt; 1) == 0) {</span>
<span class="source-line-no">436</span><span id="line-436">            codeFlags.remove(codeFlags.size() - 1);</span>
<span class="source-line-no">437</span><span id="line-437">            codeFlags.add(Long.valueOf(latestCodeFlag.intValue() | 1 &lt;&lt; 1));</span>
<span class="source-line-no">438</span><span id="line-438">            codeLineNumberTableN.add(1);</span>
<span class="source-line-no">439</span><span id="line-439">        } else {</span>
<span class="source-line-no">440</span><span id="line-440">            codeLineNumberTableN.increment(codeLineNumberTableN.size() - 1);</span>
<span class="source-line-no">441</span><span id="line-441">        }</span>
<span class="source-line-no">442</span><span id="line-442">        codeLineNumberTableLine.add(line);</span>
<span class="source-line-no">443</span><span id="line-443">        codeLineNumberTableBciP.add(start);</span>
<span class="source-line-no">444</span><span id="line-444">    }</span>
<span class="source-line-no">445</span><span id="line-445"></span>
<span class="source-line-no">446</span><span id="line-446">    public void addLocalVariable(final String name, final String desc, final String signature, final Label start, final Label end, final int indx) {</span>
<span class="source-line-no">447</span><span id="line-447">        if (signature != null) { // LocalVariableTypeTable attribute</span>
<span class="source-line-no">448</span><span id="line-448">            final Long latestCodeFlag = codeFlags.get(codeFlags.size() - 1);</span>
<span class="source-line-no">449</span><span id="line-449">            if ((latestCodeFlag.intValue() &amp; 1 &lt;&lt; 3) == 0) {</span>
<span class="source-line-no">450</span><span id="line-450">                codeFlags.remove(codeFlags.size() - 1);</span>
<span class="source-line-no">451</span><span id="line-451">                codeFlags.add(Long.valueOf(latestCodeFlag.intValue() | 1 &lt;&lt; 3));</span>
<span class="source-line-no">452</span><span id="line-452">                codeLocalVariableTypeTableN.add(1);</span>
<span class="source-line-no">453</span><span id="line-453">            } else {</span>
<span class="source-line-no">454</span><span id="line-454">                codeLocalVariableTypeTableN.increment(codeLocalVariableTypeTableN.size() - 1);</span>
<span class="source-line-no">455</span><span id="line-455">            }</span>
<span class="source-line-no">456</span><span id="line-456">            codeLocalVariableTypeTableBciP.add(start);</span>
<span class="source-line-no">457</span><span id="line-457">            codeLocalVariableTypeTableSpanO.add(end);</span>
<span class="source-line-no">458</span><span id="line-458">            codeLocalVariableTypeTableNameRU.add(cpBands.getCPUtf8(name));</span>
<span class="source-line-no">459</span><span id="line-459">            codeLocalVariableTypeTableTypeRS.add(cpBands.getCPSignature(signature));</span>
<span class="source-line-no">460</span><span id="line-460">            codeLocalVariableTypeTableSlot.add(indx);</span>
<span class="source-line-no">461</span><span id="line-461">        }</span>
<span class="source-line-no">462</span><span id="line-462">        // LocalVariableTable attribute</span>
<span class="source-line-no">463</span><span id="line-463">        codeLocalVariableTableN.increment(codeLocalVariableTableN.size() - 1);</span>
<span class="source-line-no">464</span><span id="line-464">        codeLocalVariableTableBciP.add(start);</span>
<span class="source-line-no">465</span><span id="line-465">        codeLocalVariableTableSpanO.add(end);</span>
<span class="source-line-no">466</span><span id="line-466">        codeLocalVariableTableNameRU.add(cpBands.getCPUtf8(name));</span>
<span class="source-line-no">467</span><span id="line-467">        codeLocalVariableTableTypeRS.add(cpBands.getCPSignature(desc));</span>
<span class="source-line-no">468</span><span id="line-468">        codeLocalVariableTableSlot.add(indx);</span>
<span class="source-line-no">469</span><span id="line-469">    }</span>
<span class="source-line-no">470</span><span id="line-470"></span>
<span class="source-line-no">471</span><span id="line-471">    public void addMaxStack(final int maxStack, int maxLocals) {</span>
<span class="source-line-no">472</span><span id="line-472">        final Long latestFlag = tempMethodFlags.remove(tempMethodFlags.size() - 1);</span>
<span class="source-line-no">473</span><span id="line-473">        final Long newFlag = Long.valueOf(latestFlag.intValue() | 1 &lt;&lt; 17);</span>
<span class="source-line-no">474</span><span id="line-474">        tempMethodFlags.add(newFlag);</span>
<span class="source-line-no">475</span><span id="line-475">        codeMaxStack.add(maxStack);</span>
<span class="source-line-no">476</span><span id="line-476">        if ((newFlag.longValue() &amp; 1 &lt;&lt; 3) == 0) { // not static</span>
<span class="source-line-no">477</span><span id="line-477">            maxLocals--; // minus 'this' local</span>
<span class="source-line-no">478</span><span id="line-478">        }</span>
<span class="source-line-no">479</span><span id="line-479">        maxLocals -= numMethodArgs;</span>
<span class="source-line-no">480</span><span id="line-480">        codeMaxLocals.add(maxLocals);</span>
<span class="source-line-no">481</span><span id="line-481">    }</span>
<span class="source-line-no">482</span><span id="line-482"></span>
<span class="source-line-no">483</span><span id="line-483">    public void addMethod(int flags, final String name, final String desc, final String signature, final String[] exceptions) {</span>
<span class="source-line-no">484</span><span id="line-484">        final CPNameAndType nt = cpBands.getCPNameAndType(name, desc);</span>
<span class="source-line-no">485</span><span id="line-485">        tempMethodDesc.add(nt);</span>
<span class="source-line-no">486</span><span id="line-486">        if (signature != null) {</span>
<span class="source-line-no">487</span><span id="line-487">            methodSignature.add(cpBands.getCPSignature(signature));</span>
<span class="source-line-no">488</span><span id="line-488">            flags |= 1 &lt;&lt; 19;</span>
<span class="source-line-no">489</span><span id="line-489">        }</span>
<span class="source-line-no">490</span><span id="line-490">        if (exceptions != null) {</span>
<span class="source-line-no">491</span><span id="line-491">            methodExceptionNumber.add(exceptions.length);</span>
<span class="source-line-no">492</span><span id="line-492">            for (final String exception : exceptions) {</span>
<span class="source-line-no">493</span><span id="line-493">                methodExceptionClasses.add(cpBands.getCPClass(exception));</span>
<span class="source-line-no">494</span><span id="line-494">            }</span>
<span class="source-line-no">495</span><span id="line-495">            flags |= 1 &lt;&lt; 18;</span>
<span class="source-line-no">496</span><span id="line-496">        }</span>
<span class="source-line-no">497</span><span id="line-497">        if ((flags &amp; Opcodes.ACC_DEPRECATED) != 0) { // ASM uses (1&lt;&lt;17) flag for deprecated</span>
<span class="source-line-no">498</span><span id="line-498">            flags &amp;= ~Opcodes.ACC_DEPRECATED;</span>
<span class="source-line-no">499</span><span id="line-499">            flags |= 1 &lt;&lt; 20;</span>
<span class="source-line-no">500</span><span id="line-500">        }</span>
<span class="source-line-no">501</span><span id="line-501">        tempMethodFlags.add(Long.valueOf(flags));</span>
<span class="source-line-no">502</span><span id="line-502">        numMethodArgs = countArgs(desc);</span>
<span class="source-line-no">503</span><span id="line-503">        if (!anySyntheticMethods &amp;&amp; (flags &amp; 1 &lt;&lt; 12) != 0 &amp;&amp; segment.getCurrentClassReader().hasSyntheticAttributes()) {</span>
<span class="source-line-no">504</span><span id="line-504">            cpBands.addCPUtf8("Synthetic");</span>
<span class="source-line-no">505</span><span id="line-505">            anySyntheticMethods = true;</span>
<span class="source-line-no">506</span><span id="line-506">        }</span>
<span class="source-line-no">507</span><span id="line-507">    }</span>
<span class="source-line-no">508</span><span id="line-508"></span>
<span class="source-line-no">509</span><span id="line-509">    public void addMethodAttribute(final NewAttribute attribute) {</span>
<span class="source-line-no">510</span><span id="line-510">        final String attributeName = attribute.type;</span>
<span class="source-line-no">511</span><span id="line-511">        for (final NewAttributeBands bands : methodAttributeBands) {</span>
<span class="source-line-no">512</span><span id="line-512">            if (bands.getAttributeName().equals(attributeName)) {</span>
<span class="source-line-no">513</span><span id="line-513">                bands.addAttribute(attribute);</span>
<span class="source-line-no">514</span><span id="line-514">                final int flagIndex = bands.getFlagIndex();</span>
<span class="source-line-no">515</span><span id="line-515">                final Long flags = tempMethodFlags.remove(tempMethodFlags.size() - 1);</span>
<span class="source-line-no">516</span><span id="line-516">                tempMethodFlags.add(Long.valueOf(flags.longValue() | 1 &lt;&lt; flagIndex));</span>
<span class="source-line-no">517</span><span id="line-517">                return;</span>
<span class="source-line-no">518</span><span id="line-518">            }</span>
<span class="source-line-no">519</span><span id="line-519">        }</span>
<span class="source-line-no">520</span><span id="line-520">        throw new IllegalArgumentException("No suitable definition for " + attributeName);</span>
<span class="source-line-no">521</span><span id="line-521">    }</span>
<span class="source-line-no">522</span><span id="line-522"></span>
<span class="source-line-no">523</span><span id="line-523">    public void addParameterAnnotation(final int parameter, final String desc, final boolean visible, final List&lt;String&gt; nameRU, final List&lt;String&gt; tags,</span>
<span class="source-line-no">524</span><span id="line-524">            final List&lt;Object&gt; values, final List&lt;Integer&gt; caseArrayN, final List&lt;String&gt; nestTypeRS, final List&lt;String&gt; nestNameRU,</span>
<span class="source-line-no">525</span><span id="line-525">            final List&lt;Integer&gt; nestPairN) {</span>
<span class="source-line-no">526</span><span id="line-526">        if (visible) {</span>
<span class="source-line-no">527</span><span id="line-527">            if (tempMethodRVPA == null) {</span>
<span class="source-line-no">528</span><span id="line-528">                tempMethodRVPA = new TempParamAnnotation(numMethodArgs);</span>
<span class="source-line-no">529</span><span id="line-529">                tempMethodRVPA.addParameterAnnotation(parameter, desc, nameRU, tags, values, caseArrayN, nestTypeRS, nestNameRU, nestPairN);</span>
<span class="source-line-no">530</span><span id="line-530">            }</span>
<span class="source-line-no">531</span><span id="line-531">            final Long flag = tempMethodFlags.remove(tempMethodFlags.size() - 1);</span>
<span class="source-line-no">532</span><span id="line-532">            tempMethodFlags.add(Long.valueOf(flag.longValue() | 1 &lt;&lt; 23));</span>
<span class="source-line-no">533</span><span id="line-533">        } else {</span>
<span class="source-line-no">534</span><span id="line-534">            if (tempMethodRIPA == null) {</span>
<span class="source-line-no">535</span><span id="line-535">                tempMethodRIPA = new TempParamAnnotation(numMethodArgs);</span>
<span class="source-line-no">536</span><span id="line-536">                tempMethodRIPA.addParameterAnnotation(parameter, desc, nameRU, tags, values, caseArrayN, nestTypeRS, nestNameRU, nestPairN);</span>
<span class="source-line-no">537</span><span id="line-537">            }</span>
<span class="source-line-no">538</span><span id="line-538">            final Long flag = tempMethodFlags.remove(tempMethodFlags.size() - 1);</span>
<span class="source-line-no">539</span><span id="line-539">            tempMethodFlags.add(Long.valueOf(flag.longValue() | 1 &lt;&lt; 24));</span>
<span class="source-line-no">540</span><span id="line-540">        }</span>
<span class="source-line-no">541</span><span id="line-541">    }</span>
<span class="source-line-no">542</span><span id="line-542"></span>
<span class="source-line-no">543</span><span id="line-543">    public void addSourceFile(final String source) {</span>
<span class="source-line-no">544</span><span id="line-544">        String implicitSourceFileName = class_this[index].toString();</span>
<span class="source-line-no">545</span><span id="line-545">        if (implicitSourceFileName.indexOf('$') != -1) {</span>
<span class="source-line-no">546</span><span id="line-546">            implicitSourceFileName = implicitSourceFileName.substring(0, implicitSourceFileName.indexOf('$'));</span>
<span class="source-line-no">547</span><span id="line-547">        }</span>
<span class="source-line-no">548</span><span id="line-548">        implicitSourceFileName = implicitSourceFileName.substring(implicitSourceFileName.lastIndexOf('/') + 1) + ".java";</span>
<span class="source-line-no">549</span><span id="line-549">        if (source.equals(implicitSourceFileName)) {</span>
<span class="source-line-no">550</span><span id="line-550">            classSourceFile.add(null);</span>
<span class="source-line-no">551</span><span id="line-551">        } else {</span>
<span class="source-line-no">552</span><span id="line-552">            classSourceFile.add(cpBands.getCPUtf8(source));</span>
<span class="source-line-no">553</span><span id="line-553">        }</span>
<span class="source-line-no">554</span><span id="line-554">        class_flags[index] |= 1 &lt;&lt; 17;</span>
<span class="source-line-no">555</span><span id="line-555">    }</span>
<span class="source-line-no">556</span><span id="line-556"></span>
<span class="source-line-no">557</span><span id="line-557">    private void createNewAttributeBands() throws IOException {</span>
<span class="source-line-no">558</span><span id="line-558">        for (final AttributeDefinition def : attrBands.getClassAttributeLayouts()) {</span>
<span class="source-line-no">559</span><span id="line-559">            classAttributeBands.add(new NewAttributeBands(effort, cpBands, segment.getSegmentHeader(), def));</span>
<span class="source-line-no">560</span><span id="line-560">        }</span>
<span class="source-line-no">561</span><span id="line-561">        for (final AttributeDefinition def : attrBands.getMethodAttributeLayouts()) {</span>
<span class="source-line-no">562</span><span id="line-562">            methodAttributeBands.add(new NewAttributeBands(effort, cpBands, segment.getSegmentHeader(), def));</span>
<span class="source-line-no">563</span><span id="line-563">        }</span>
<span class="source-line-no">564</span><span id="line-564">        for (final AttributeDefinition def : attrBands.getFieldAttributeLayouts()) {</span>
<span class="source-line-no">565</span><span id="line-565">            fieldAttributeBands.add(new NewAttributeBands(effort, cpBands, segment.getSegmentHeader(), def));</span>
<span class="source-line-no">566</span><span id="line-566">        }</span>
<span class="source-line-no">567</span><span id="line-567">        for (final AttributeDefinition def : attrBands.getCodeAttributeLayouts()) {</span>
<span class="source-line-no">568</span><span id="line-568">            codeAttributeBands.add(new NewAttributeBands(effort, cpBands, segment.getSegmentHeader(), def));</span>
<span class="source-line-no">569</span><span id="line-569">        }</span>
<span class="source-line-no">570</span><span id="line-570">    }</span>
<span class="source-line-no">571</span><span id="line-571"></span>
<span class="source-line-no">572</span><span id="line-572">    public void currentClassReferencesInnerClass(final CPClass inner) {</span>
<span class="source-line-no">573</span><span id="line-573">        if (!(index &gt;= class_this.length)) {</span>
<span class="source-line-no">574</span><span id="line-574">            final CPClass currentClass = class_this[index];</span>
<span class="source-line-no">575</span><span id="line-575">            if (currentClass != null &amp;&amp; !currentClass.equals(inner) &amp;&amp; !isInnerClassOf(currentClass.toString(), inner)) {</span>
<span class="source-line-no">576</span><span id="line-576">                classReferencesInnerClass.computeIfAbsent(currentClass, c -&gt; new HashSet&lt;&gt;()).add(inner);</span>
<span class="source-line-no">577</span><span id="line-577">            }</span>
<span class="source-line-no">578</span><span id="line-578">        }</span>
<span class="source-line-no">579</span><span id="line-579">    }</span>
<span class="source-line-no">580</span><span id="line-580"></span>
<span class="source-line-no">581</span><span id="line-581">    public void doBciRenumbering(final IntList bciRenumbering, final Map&lt;Label, Integer&gt; labelsToOffsets) {</span>
<span class="source-line-no">582</span><span id="line-582">        renumberBci(codeLineNumberTableBciP, bciRenumbering, labelsToOffsets);</span>
<span class="source-line-no">583</span><span id="line-583">        renumberBci(codeLocalVariableTableBciP, bciRenumbering, labelsToOffsets);</span>
<span class="source-line-no">584</span><span id="line-584">        renumberOffsetBci(codeLocalVariableTableBciP, codeLocalVariableTableSpanO, bciRenumbering, labelsToOffsets);</span>
<span class="source-line-no">585</span><span id="line-585">        renumberBci(codeLocalVariableTypeTableBciP, bciRenumbering, labelsToOffsets);</span>
<span class="source-line-no">586</span><span id="line-586">        renumberOffsetBci(codeLocalVariableTypeTableBciP, codeLocalVariableTypeTableSpanO, bciRenumbering, labelsToOffsets);</span>
<span class="source-line-no">587</span><span id="line-587">        renumberBci(codeHandlerStartP, bciRenumbering, labelsToOffsets);</span>
<span class="source-line-no">588</span><span id="line-588">        renumberOffsetBci(codeHandlerStartP, codeHandlerEndPO, bciRenumbering, labelsToOffsets);</span>
<span class="source-line-no">589</span><span id="line-589">        renumberDoubleOffsetBci(codeHandlerStartP, codeHandlerEndPO, codeHandlerCatchPO, bciRenumbering, labelsToOffsets);</span>
<span class="source-line-no">590</span><span id="line-590"></span>
<span class="source-line-no">591</span><span id="line-591">        for (final NewAttributeBands newAttributeBandSet : classAttributeBands) {</span>
<span class="source-line-no">592</span><span id="line-592">            newAttributeBandSet.renumberBci(bciRenumbering, labelsToOffsets);</span>
<span class="source-line-no">593</span><span id="line-593">        }</span>
<span class="source-line-no">594</span><span id="line-594">        for (final NewAttributeBands newAttributeBandSet : methodAttributeBands) {</span>
<span class="source-line-no">595</span><span id="line-595">            newAttributeBandSet.renumberBci(bciRenumbering, labelsToOffsets);</span>
<span class="source-line-no">596</span><span id="line-596">        }</span>
<span class="source-line-no">597</span><span id="line-597">        for (final NewAttributeBands newAttributeBandSet : fieldAttributeBands) {</span>
<span class="source-line-no">598</span><span id="line-598">            newAttributeBandSet.renumberBci(bciRenumbering, labelsToOffsets);</span>
<span class="source-line-no">599</span><span id="line-599">        }</span>
<span class="source-line-no">600</span><span id="line-600">        for (final NewAttributeBands newAttributeBandSet : codeAttributeBands) {</span>
<span class="source-line-no">601</span><span id="line-601">            newAttributeBandSet.renumberBci(bciRenumbering, labelsToOffsets);</span>
<span class="source-line-no">602</span><span id="line-602">        }</span>
<span class="source-line-no">603</span><span id="line-603">    }</span>
<span class="source-line-no">604</span><span id="line-604"></span>
<span class="source-line-no">605</span><span id="line-605">    public void endOfClass() { // All the data for the current class has been</span>
<span class="source-line-no">606</span><span id="line-606">                               // read</span>
<span class="source-line-no">607</span><span id="line-607">        final int numFields = tempFieldDesc.size();</span>
<span class="source-line-no">608</span><span id="line-608">        class_field_count[index] = numFields;</span>
<span class="source-line-no">609</span><span id="line-609">        field_descr[index] = new CPNameAndType[numFields];</span>
<span class="source-line-no">610</span><span id="line-610">        field_flags[index] = new long[numFields];</span>
<span class="source-line-no">611</span><span id="line-611">        for (int i = 0; i &lt; numFields; i++) {</span>
<span class="source-line-no">612</span><span id="line-612">            field_descr[index][i] = tempFieldDesc.get(i);</span>
<span class="source-line-no">613</span><span id="line-613">            field_flags[index][i] = tempFieldFlags.get(i).longValue();</span>
<span class="source-line-no">614</span><span id="line-614">        }</span>
<span class="source-line-no">615</span><span id="line-615">        final int numMethods = tempMethodDesc.size();</span>
<span class="source-line-no">616</span><span id="line-616">        class_method_count[index] = numMethods;</span>
<span class="source-line-no">617</span><span id="line-617">        method_descr[index] = new CPNameAndType[numMethods];</span>
<span class="source-line-no">618</span><span id="line-618">        method_flags[index] = new long[numMethods];</span>
<span class="source-line-no">619</span><span id="line-619">        for (int i = 0; i &lt; numMethods; i++) {</span>
<span class="source-line-no">620</span><span id="line-620">            method_descr[index][i] = tempMethodDesc.get(i);</span>
<span class="source-line-no">621</span><span id="line-621">            method_flags[index][i] = tempMethodFlags.get(i).longValue();</span>
<span class="source-line-no">622</span><span id="line-622">        }</span>
<span class="source-line-no">623</span><span id="line-623">        tempFieldDesc.clear();</span>
<span class="source-line-no">624</span><span id="line-624">        tempFieldFlags.clear();</span>
<span class="source-line-no">625</span><span id="line-625">        tempMethodDesc.clear();</span>
<span class="source-line-no">626</span><span id="line-626">        tempMethodFlags.clear();</span>
<span class="source-line-no">627</span><span id="line-627">        index++;</span>
<span class="source-line-no">628</span><span id="line-628">    }</span>
<span class="source-line-no">629</span><span id="line-629"></span>
<span class="source-line-no">630</span><span id="line-630">    public void endOfMethod() {</span>
<span class="source-line-no">631</span><span id="line-631">        if (tempMethodRVPA != null) {</span>
<span class="source-line-no">632</span><span id="line-632">            method_RVPA_bands.addParameterAnnotation(tempMethodRVPA.numParams, tempMethodRVPA.annoN, tempMethodRVPA.pairN, tempMethodRVPA.typeRS,</span>
<span class="source-line-no">633</span><span id="line-633">                    tempMethodRVPA.nameRU, tempMethodRVPA.tags, tempMethodRVPA.values, tempMethodRVPA.caseArrayN, tempMethodRVPA.nestTypeRS,</span>
<span class="source-line-no">634</span><span id="line-634">                    tempMethodRVPA.nestNameRU, tempMethodRVPA.nestPairN);</span>
<span class="source-line-no">635</span><span id="line-635">            tempMethodRVPA = null;</span>
<span class="source-line-no">636</span><span id="line-636">        }</span>
<span class="source-line-no">637</span><span id="line-637">        if (tempMethodRIPA != null) {</span>
<span class="source-line-no">638</span><span id="line-638">            method_RIPA_bands.addParameterAnnotation(tempMethodRIPA.numParams, tempMethodRIPA.annoN, tempMethodRIPA.pairN, tempMethodRIPA.typeRS,</span>
<span class="source-line-no">639</span><span id="line-639">                    tempMethodRIPA.nameRU, tempMethodRIPA.tags, tempMethodRIPA.values, tempMethodRIPA.caseArrayN, tempMethodRIPA.nestTypeRS,</span>
<span class="source-line-no">640</span><span id="line-640">                    tempMethodRIPA.nestNameRU, tempMethodRIPA.nestPairN);</span>
<span class="source-line-no">641</span><span id="line-641">            tempMethodRIPA = null;</span>
<span class="source-line-no">642</span><span id="line-642">        }</span>
<span class="source-line-no">643</span><span id="line-643">        if (codeFlags.size() &gt; 0) {</span>
<span class="source-line-no">644</span><span id="line-644">            final long latestCodeFlag = codeFlags.get(codeFlags.size() - 1).longValue();</span>
<span class="source-line-no">645</span><span id="line-645">            final int latestLocalVariableTableN = codeLocalVariableTableN.get(codeLocalVariableTableN.size() - 1);</span>
<span class="source-line-no">646</span><span id="line-646">            if (latestCodeFlag == 1 &lt;&lt; 2 &amp;&amp; latestLocalVariableTableN == 0) {</span>
<span class="source-line-no">647</span><span id="line-647">                codeLocalVariableTableN.remove(codeLocalVariableTableN.size() - 1);</span>
<span class="source-line-no">648</span><span id="line-648">                codeFlags.remove(codeFlags.size() - 1);</span>
<span class="source-line-no">649</span><span id="line-649">                codeFlags.add(Long.valueOf(0));</span>
<span class="source-line-no">650</span><span id="line-650">            }</span>
<span class="source-line-no">651</span><span id="line-651">        }</span>
<span class="source-line-no">652</span><span id="line-652">    }</span>
<span class="source-line-no">653</span><span id="line-653"></span>
<span class="source-line-no">654</span><span id="line-654">    /**</span>
<span class="source-line-no">655</span><span id="line-655">     * All input classes for the segment have now been read in, so this method is called so that this class can calculate/complete anything it could not do</span>
<span class="source-line-no">656</span><span id="line-656">     * while classes were being read.</span>
<span class="source-line-no">657</span><span id="line-657">     */</span>
<span class="source-line-no">658</span><span id="line-658">    public void finaliseBands() {</span>
<span class="source-line-no">659</span><span id="line-659">        final int defaultMajorVersion = segmentHeader.getDefaultMajorVersion();</span>
<span class="source-line-no">660</span><span id="line-660">        for (int i = 0; i &lt; class_flags.length; i++) {</span>
<span class="source-line-no">661</span><span id="line-661">            final int major = major_versions[i];</span>
<span class="source-line-no">662</span><span id="line-662">            if (major != defaultMajorVersion) {</span>
<span class="source-line-no">663</span><span id="line-663">                class_flags[i] |= 1 &lt;&lt; 24;</span>
<span class="source-line-no">664</span><span id="line-664">                classFileVersionMajor.add(major);</span>
<span class="source-line-no">665</span><span id="line-665">                classFileVersionMinor.add(0);</span>
<span class="source-line-no">666</span><span id="line-666">            }</span>
<span class="source-line-no">667</span><span id="line-667">        }</span>
<span class="source-line-no">668</span><span id="line-668">        // Calculate code headers</span>
<span class="source-line-no">669</span><span id="line-669">        codeHeaders = new int[codeHandlerCount.size()];</span>
<span class="source-line-no">670</span><span id="line-670">        int removed = 0;</span>
<span class="source-line-no">671</span><span id="line-671">        for (int i = 0; i &lt; codeHeaders.length; i++) {</span>
<span class="source-line-no">672</span><span id="line-672">            final int numHandlers = codeHandlerCount.get(i - removed);</span>
<span class="source-line-no">673</span><span id="line-673">            final int maxLocals = codeMaxLocals.get(i - removed);</span>
<span class="source-line-no">674</span><span id="line-674">            final int maxStack = codeMaxStack.get(i - removed);</span>
<span class="source-line-no">675</span><span id="line-675">            switch (numHandlers) {</span>
<span class="source-line-no">676</span><span id="line-676">            case 0: {</span>
<span class="source-line-no">677</span><span id="line-677">                final int header = maxLocals * 12 + maxStack + 1;</span>
<span class="source-line-no">678</span><span id="line-678">                if (header &lt; 145 &amp;&amp; maxStack &lt; 12) {</span>
<span class="source-line-no">679</span><span id="line-679">                    codeHeaders[i] = header;</span>
<span class="source-line-no">680</span><span id="line-680">                }</span>
<span class="source-line-no">681</span><span id="line-681">                break;</span>
<span class="source-line-no">682</span><span id="line-682">            }</span>
<span class="source-line-no">683</span><span id="line-683">            case 1: {</span>
<span class="source-line-no">684</span><span id="line-684">                final int header = maxLocals * 8 + maxStack + 145;</span>
<span class="source-line-no">685</span><span id="line-685">                if (header &lt; 209 &amp;&amp; maxStack &lt; 8) {</span>
<span class="source-line-no">686</span><span id="line-686">                    codeHeaders[i] = header;</span>
<span class="source-line-no">687</span><span id="line-687">                }</span>
<span class="source-line-no">688</span><span id="line-688">                break;</span>
<span class="source-line-no">689</span><span id="line-689">            }</span>
<span class="source-line-no">690</span><span id="line-690">            case 2: {</span>
<span class="source-line-no">691</span><span id="line-691">                final int header = maxLocals * 7 + maxStack + 209;</span>
<span class="source-line-no">692</span><span id="line-692">                if (header &lt; 256 &amp;&amp; maxStack &lt; 7) {</span>
<span class="source-line-no">693</span><span id="line-693">                    codeHeaders[i] = header;</span>
<span class="source-line-no">694</span><span id="line-694">                }</span>
<span class="source-line-no">695</span><span id="line-695">                break;</span>
<span class="source-line-no">696</span><span id="line-696">            }</span>
<span class="source-line-no">697</span><span id="line-697">            default:</span>
<span class="source-line-no">698</span><span id="line-698">                break;</span>
<span class="source-line-no">699</span><span id="line-699">            }</span>
<span class="source-line-no">700</span><span id="line-700">            if (codeHeaders[i] != 0) { // Remove the redundant values from</span>
<span class="source-line-no">701</span><span id="line-701">                                       // codeHandlerCount, codeMaxLocals and</span>
<span class="source-line-no">702</span><span id="line-702">                                       // codeMaxStack</span>
<span class="source-line-no">703</span><span id="line-703">                codeHandlerCount.remove(i - removed);</span>
<span class="source-line-no">704</span><span id="line-704">                codeMaxLocals.remove(i - removed);</span>
<span class="source-line-no">705</span><span id="line-705">                codeMaxStack.remove(i - removed);</span>
<span class="source-line-no">706</span><span id="line-706">                removed++;</span>
<span class="source-line-no">707</span><span id="line-707">            } else if (!segment.getSegmentHeader().have_all_code_flags()) {</span>
<span class="source-line-no">708</span><span id="line-708">                codeFlags.add(Long.valueOf(0));</span>
<span class="source-line-no">709</span><span id="line-709">            }</span>
<span class="source-line-no">710</span><span id="line-710">        }</span>
<span class="source-line-no">711</span><span id="line-711"></span>
<span class="source-line-no">712</span><span id="line-712">        // Compute any required IcLocals</span>
<span class="source-line-no">713</span><span id="line-713">        final IntList innerClassesN = new IntList();</span>
<span class="source-line-no">714</span><span id="line-714">        final List&lt;IcTuple&gt; icLocal = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">715</span><span id="line-715">        for (int i = 0; i &lt; class_this.length; i++) {</span>
<span class="source-line-no">716</span><span id="line-716">            final CPClass cpClass = class_this[i];</span>
<span class="source-line-no">717</span><span id="line-717">            final Set&lt;CPClass&gt; referencedInnerClasses = classReferencesInnerClass.get(cpClass);</span>
<span class="source-line-no">718</span><span id="line-718">            if (referencedInnerClasses != null) {</span>
<span class="source-line-no">719</span><span id="line-719">                int innerN = 0;</span>
<span class="source-line-no">720</span><span id="line-720">                final List&lt;IcTuple&gt; innerClasses = segment.getIcBands().getInnerClassesForOuter(cpClass.toString());</span>
<span class="source-line-no">721</span><span id="line-721">                if (innerClasses != null) {</span>
<span class="source-line-no">722</span><span id="line-722">                    for (final IcTuple element : innerClasses) {</span>
<span class="source-line-no">723</span><span id="line-723">                        referencedInnerClasses.remove(element.C);</span>
<span class="source-line-no">724</span><span id="line-724">                    }</span>
<span class="source-line-no">725</span><span id="line-725">                }</span>
<span class="source-line-no">726</span><span id="line-726">                for (final CPClass inner : referencedInnerClasses) {</span>
<span class="source-line-no">727</span><span id="line-727">                    final IcTuple icTuple = segment.getIcBands().getIcTuple(inner);</span>
<span class="source-line-no">728</span><span id="line-728">                    if (icTuple != null &amp;&amp; !icTuple.isAnonymous()) {</span>
<span class="source-line-no">729</span><span id="line-729">                        // should transmit an icLocal entry</span>
<span class="source-line-no">730</span><span id="line-730">                        icLocal.add(icTuple);</span>
<span class="source-line-no">731</span><span id="line-731">                        innerN++;</span>
<span class="source-line-no">732</span><span id="line-732">                    }</span>
<span class="source-line-no">733</span><span id="line-733">                }</span>
<span class="source-line-no">734</span><span id="line-734">                if (innerN != 0) {</span>
<span class="source-line-no">735</span><span id="line-735">                    innerClassesN.add(innerN);</span>
<span class="source-line-no">736</span><span id="line-736">                    class_flags[i] |= 1 &lt;&lt; 23;</span>
<span class="source-line-no">737</span><span id="line-737">                }</span>
<span class="source-line-no">738</span><span id="line-738">            }</span>
<span class="source-line-no">739</span><span id="line-739">        }</span>
<span class="source-line-no">740</span><span id="line-740">        class_InnerClasses_N = innerClassesN.toArray();</span>
<span class="source-line-no">741</span><span id="line-741">        class_InnerClasses_RC = new CPClass[icLocal.size()];</span>
<span class="source-line-no">742</span><span id="line-742">        class_InnerClasses_F = new int[icLocal.size()];</span>
<span class="source-line-no">743</span><span id="line-743">        classInnerClassesOuterRCN = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">744</span><span id="line-744">        classInnerClassesNameRUN = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">745</span><span id="line-745">        for (int i = 0; i &lt; class_InnerClasses_RC.length; i++) {</span>
<span class="source-line-no">746</span><span id="line-746">            final IcTuple icTuple = icLocal.get(i);</span>
<span class="source-line-no">747</span><span id="line-747">            class_InnerClasses_RC[i] = icTuple.C;</span>
<span class="source-line-no">748</span><span id="line-748">            if (icTuple.C2 == null &amp;&amp; icTuple.N == null) {</span>
<span class="source-line-no">749</span><span id="line-749">                class_InnerClasses_F[i] = 0;</span>
<span class="source-line-no">750</span><span id="line-750">            } else {</span>
<span class="source-line-no">751</span><span id="line-751">                if (icTuple.F == 0) {</span>
<span class="source-line-no">752</span><span id="line-752">                    class_InnerClasses_F[i] = 0x00010000;</span>
<span class="source-line-no">753</span><span id="line-753">                } else {</span>
<span class="source-line-no">754</span><span id="line-754">                    class_InnerClasses_F[i] = icTuple.F;</span>
<span class="source-line-no">755</span><span id="line-755">                }</span>
<span class="source-line-no">756</span><span id="line-756">                classInnerClassesOuterRCN.add(icTuple.C2);</span>
<span class="source-line-no">757</span><span id="line-757">                classInnerClassesNameRUN.add(icTuple.N);</span>
<span class="source-line-no">758</span><span id="line-758">            }</span>
<span class="source-line-no">759</span><span id="line-759">        }</span>
<span class="source-line-no">760</span><span id="line-760">        // Calculate any backwards calls from metadata bands</span>
<span class="source-line-no">761</span><span id="line-761">        final IntList classAttrCalls = new IntList();</span>
<span class="source-line-no">762</span><span id="line-762">        final IntList fieldAttrCalls = new IntList();</span>
<span class="source-line-no">763</span><span id="line-763">        final IntList methodAttrCalls = new IntList();</span>
<span class="source-line-no">764</span><span id="line-764">        final IntList codeAttrCalls = new IntList();</span>
<span class="source-line-no">765</span><span id="line-765"></span>
<span class="source-line-no">766</span><span id="line-766">        if (class_RVA_bands.hasContent()) {</span>
<span class="source-line-no">767</span><span id="line-767">            classAttrCalls.add(class_RVA_bands.numBackwardsCalls());</span>
<span class="source-line-no">768</span><span id="line-768">        }</span>
<span class="source-line-no">769</span><span id="line-769">        if (class_RIA_bands.hasContent()) {</span>
<span class="source-line-no">770</span><span id="line-770">            classAttrCalls.add(class_RIA_bands.numBackwardsCalls());</span>
<span class="source-line-no">771</span><span id="line-771">        }</span>
<span class="source-line-no">772</span><span id="line-772">        if (field_RVA_bands.hasContent()) {</span>
<span class="source-line-no">773</span><span id="line-773">            fieldAttrCalls.add(field_RVA_bands.numBackwardsCalls());</span>
<span class="source-line-no">774</span><span id="line-774">        }</span>
<span class="source-line-no">775</span><span id="line-775">        if (field_RIA_bands.hasContent()) {</span>
<span class="source-line-no">776</span><span id="line-776">            fieldAttrCalls.add(field_RIA_bands.numBackwardsCalls());</span>
<span class="source-line-no">777</span><span id="line-777">        }</span>
<span class="source-line-no">778</span><span id="line-778">        if (method_RVA_bands.hasContent()) {</span>
<span class="source-line-no">779</span><span id="line-779">            methodAttrCalls.add(method_RVA_bands.numBackwardsCalls());</span>
<span class="source-line-no">780</span><span id="line-780">        }</span>
<span class="source-line-no">781</span><span id="line-781">        if (method_RIA_bands.hasContent()) {</span>
<span class="source-line-no">782</span><span id="line-782">            methodAttrCalls.add(method_RIA_bands.numBackwardsCalls());</span>
<span class="source-line-no">783</span><span id="line-783">        }</span>
<span class="source-line-no">784</span><span id="line-784">        if (method_RVPA_bands.hasContent()) {</span>
<span class="source-line-no">785</span><span id="line-785">            methodAttrCalls.add(method_RVPA_bands.numBackwardsCalls());</span>
<span class="source-line-no">786</span><span id="line-786">        }</span>
<span class="source-line-no">787</span><span id="line-787">        if (method_RIPA_bands.hasContent()) {</span>
<span class="source-line-no">788</span><span id="line-788">            methodAttrCalls.add(method_RIPA_bands.numBackwardsCalls());</span>
<span class="source-line-no">789</span><span id="line-789">        }</span>
<span class="source-line-no">790</span><span id="line-790">        if (method_AD_bands.hasContent()) {</span>
<span class="source-line-no">791</span><span id="line-791">            methodAttrCalls.add(method_AD_bands.numBackwardsCalls());</span>
<span class="source-line-no">792</span><span id="line-792">        }</span>
<span class="source-line-no">793</span><span id="line-793"></span>
<span class="source-line-no">794</span><span id="line-794">        // Sort non-predefined attribute bands</span>
<span class="source-line-no">795</span><span id="line-795">        final Comparator&lt;NewAttributeBands&gt; comparator = (arg0, arg1) -&gt; arg0.getFlagIndex() - arg1.getFlagIndex();</span>
<span class="source-line-no">796</span><span id="line-796">        classAttributeBands.sort(comparator);</span>
<span class="source-line-no">797</span><span id="line-797">        methodAttributeBands.sort(comparator);</span>
<span class="source-line-no">798</span><span id="line-798">        fieldAttributeBands.sort(comparator);</span>
<span class="source-line-no">799</span><span id="line-799">        codeAttributeBands.sort(comparator);</span>
<span class="source-line-no">800</span><span id="line-800"></span>
<span class="source-line-no">801</span><span id="line-801">        for (final NewAttributeBands bands : classAttributeBands) {</span>
<span class="source-line-no">802</span><span id="line-802">            if (bands.isUsedAtLeastOnce()) {</span>
<span class="source-line-no">803</span><span id="line-803">                for (final int backwardsCallCount : bands.numBackwardsCalls()) {</span>
<span class="source-line-no">804</span><span id="line-804">                    classAttrCalls.add(backwardsCallCount);</span>
<span class="source-line-no">805</span><span id="line-805">                }</span>
<span class="source-line-no">806</span><span id="line-806">            }</span>
<span class="source-line-no">807</span><span id="line-807">        }</span>
<span class="source-line-no">808</span><span id="line-808">        for (final NewAttributeBands bands : methodAttributeBands) {</span>
<span class="source-line-no">809</span><span id="line-809">            if (bands.isUsedAtLeastOnce()) {</span>
<span class="source-line-no">810</span><span id="line-810">                for (final int backwardsCallCount : bands.numBackwardsCalls()) {</span>
<span class="source-line-no">811</span><span id="line-811">                    methodAttrCalls.add(backwardsCallCount);</span>
<span class="source-line-no">812</span><span id="line-812">                }</span>
<span class="source-line-no">813</span><span id="line-813">            }</span>
<span class="source-line-no">814</span><span id="line-814">        }</span>
<span class="source-line-no">815</span><span id="line-815">        for (final NewAttributeBands bands : fieldAttributeBands) {</span>
<span class="source-line-no">816</span><span id="line-816">            if (bands.isUsedAtLeastOnce()) {</span>
<span class="source-line-no">817</span><span id="line-817">                for (final int backwardsCallCount : bands.numBackwardsCalls()) {</span>
<span class="source-line-no">818</span><span id="line-818">                    fieldAttrCalls.add(backwardsCallCount);</span>
<span class="source-line-no">819</span><span id="line-819">                }</span>
<span class="source-line-no">820</span><span id="line-820">            }</span>
<span class="source-line-no">821</span><span id="line-821">        }</span>
<span class="source-line-no">822</span><span id="line-822">        for (final NewAttributeBands bands : codeAttributeBands) {</span>
<span class="source-line-no">823</span><span id="line-823">            if (bands.isUsedAtLeastOnce()) {</span>
<span class="source-line-no">824</span><span id="line-824">                for (final int backwardsCallCount : bands.numBackwardsCalls()) {</span>
<span class="source-line-no">825</span><span id="line-825">                    codeAttrCalls.add(backwardsCallCount);</span>
<span class="source-line-no">826</span><span id="line-826">                }</span>
<span class="source-line-no">827</span><span id="line-827">            }</span>
<span class="source-line-no">828</span><span id="line-828">        }</span>
<span class="source-line-no">829</span><span id="line-829"></span>
<span class="source-line-no">830</span><span id="line-830">        class_attr_calls = classAttrCalls.toArray();</span>
<span class="source-line-no">831</span><span id="line-831">        field_attr_calls = fieldAttrCalls.toArray();</span>
<span class="source-line-no">832</span><span id="line-832">        method_attr_calls = methodAttrCalls.toArray();</span>
<span class="source-line-no">833</span><span id="line-833">        code_attr_calls = codeAttrCalls.toArray();</span>
<span class="source-line-no">834</span><span id="line-834">    }</span>
<span class="source-line-no">835</span><span id="line-835"></span>
<span class="source-line-no">836</span><span id="line-836">    private int[] getInts(final CPClass[] cpClasses) {</span>
<span class="source-line-no">837</span><span id="line-837">        final int[] ints = new int[cpClasses.length];</span>
<span class="source-line-no">838</span><span id="line-838">        for (int i = 0; i &lt; ints.length; i++) {</span>
<span class="source-line-no">839</span><span id="line-839">            if (cpClasses[i] != null) {</span>
<span class="source-line-no">840</span><span id="line-840">                ints[i] = cpClasses[i].getIndex();</span>
<span class="source-line-no">841</span><span id="line-841">            }</span>
<span class="source-line-no">842</span><span id="line-842">        }</span>
<span class="source-line-no">843</span><span id="line-843">        return ints;</span>
<span class="source-line-no">844</span><span id="line-844">    }</span>
<span class="source-line-no">845</span><span id="line-845"></span>
<span class="source-line-no">846</span><span id="line-846">    public boolean isAnySyntheticClasses() {</span>
<span class="source-line-no">847</span><span id="line-847">        return anySyntheticClasses;</span>
<span class="source-line-no">848</span><span id="line-848">    }</span>
<span class="source-line-no">849</span><span id="line-849"></span>
<span class="source-line-no">850</span><span id="line-850">    public boolean isAnySyntheticFields() {</span>
<span class="source-line-no">851</span><span id="line-851">        return anySyntheticFields;</span>
<span class="source-line-no">852</span><span id="line-852">    }</span>
<span class="source-line-no">853</span><span id="line-853"></span>
<span class="source-line-no">854</span><span id="line-854">    public boolean isAnySyntheticMethods() {</span>
<span class="source-line-no">855</span><span id="line-855">        return anySyntheticMethods;</span>
<span class="source-line-no">856</span><span id="line-856">    }</span>
<span class="source-line-no">857</span><span id="line-857"></span>
<span class="source-line-no">858</span><span id="line-858">    private boolean isInnerClass(final String possibleInner) {</span>
<span class="source-line-no">859</span><span id="line-859">        return possibleInner.indexOf('$') != -1;</span>
<span class="source-line-no">860</span><span id="line-860">    }</span>
<span class="source-line-no">861</span><span id="line-861"></span>
<span class="source-line-no">862</span><span id="line-862">    private boolean isInnerClassOf(final String possibleInner, final CPClass possibleOuter) {</span>
<span class="source-line-no">863</span><span id="line-863">        if (isInnerClass(possibleInner)) {</span>
<span class="source-line-no">864</span><span id="line-864">            final String superClassName = possibleInner.substring(0, possibleInner.lastIndexOf('$'));</span>
<span class="source-line-no">865</span><span id="line-865">            if (superClassName.equals(possibleOuter.toString())) {</span>
<span class="source-line-no">866</span><span id="line-866">                return true;</span>
<span class="source-line-no">867</span><span id="line-867">            }</span>
<span class="source-line-no">868</span><span id="line-868">            return isInnerClassOf(superClassName, possibleOuter);</span>
<span class="source-line-no">869</span><span id="line-869">        }</span>
<span class="source-line-no">870</span><span id="line-870">        return false;</span>
<span class="source-line-no">871</span><span id="line-871">    }</span>
<span class="source-line-no">872</span><span id="line-872"></span>
<span class="source-line-no">873</span><span id="line-873">    public int numClassesProcessed() {</span>
<span class="source-line-no">874</span><span id="line-874">        return index;</span>
<span class="source-line-no">875</span><span id="line-875">    }</span>
<span class="source-line-no">876</span><span id="line-876"></span>
<span class="source-line-no">877</span><span id="line-877">    @Override</span>
<span class="source-line-no">878</span><span id="line-878">    public void pack(final OutputStream out) throws IOException, Pack200Exception {</span>
<span class="source-line-no">879</span><span id="line-879">        PackingUtils.log("Writing class bands...");</span>
<span class="source-line-no">880</span><span id="line-880"></span>
<span class="source-line-no">881</span><span id="line-881">        byte[] encodedBand = encodeBandInt("class_this", getInts(class_this), Codec.DELTA5);</span>
<span class="source-line-no">882</span><span id="line-882">        out.write(encodedBand);</span>
<span class="source-line-no">883</span><span id="line-883">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_this[" + class_this.length + "]");</span>
<span class="source-line-no">884</span><span id="line-884"></span>
<span class="source-line-no">885</span><span id="line-885">        encodedBand = encodeBandInt("class_super", getInts(class_super), Codec.DELTA5);</span>
<span class="source-line-no">886</span><span id="line-886">        out.write(encodedBand);</span>
<span class="source-line-no">887</span><span id="line-887">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_super[" + class_super.length + "]");</span>
<span class="source-line-no">888</span><span id="line-888"></span>
<span class="source-line-no">889</span><span id="line-889">        encodedBand = encodeBandInt("class_interface_count", class_interface_count, Codec.DELTA5);</span>
<span class="source-line-no">890</span><span id="line-890">        out.write(encodedBand);</span>
<span class="source-line-no">891</span><span id="line-891">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_interface_count[" + class_interface_count.length + "]");</span>
<span class="source-line-no">892</span><span id="line-892"></span>
<span class="source-line-no">893</span><span id="line-893">        final int totalInterfaces = sum(class_interface_count);</span>
<span class="source-line-no">894</span><span id="line-894">        final int[] classInterface = new int[totalInterfaces];</span>
<span class="source-line-no">895</span><span id="line-895">        int k = 0;</span>
<span class="source-line-no">896</span><span id="line-896">        for (final CPClass[] element : class_interface) {</span>
<span class="source-line-no">897</span><span id="line-897">            if (element != null) {</span>
<span class="source-line-no">898</span><span id="line-898">                for (final CPClass cpClass : element) {</span>
<span class="source-line-no">899</span><span id="line-899">                    classInterface[k] = cpClass.getIndex();</span>
<span class="source-line-no">900</span><span id="line-900">                    k++;</span>
<span class="source-line-no">901</span><span id="line-901">                }</span>
<span class="source-line-no">902</span><span id="line-902">            }</span>
<span class="source-line-no">903</span><span id="line-903">        }</span>
<span class="source-line-no">904</span><span id="line-904"></span>
<span class="source-line-no">905</span><span id="line-905">        encodedBand = encodeBandInt("class_interface", classInterface, Codec.DELTA5);</span>
<span class="source-line-no">906</span><span id="line-906">        out.write(encodedBand);</span>
<span class="source-line-no">907</span><span id="line-907">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_interface[" + classInterface.length + "]");</span>
<span class="source-line-no">908</span><span id="line-908"></span>
<span class="source-line-no">909</span><span id="line-909">        encodedBand = encodeBandInt("class_field_count", class_field_count, Codec.DELTA5);</span>
<span class="source-line-no">910</span><span id="line-910">        out.write(encodedBand);</span>
<span class="source-line-no">911</span><span id="line-911">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_field_count[" + class_field_count.length + "]");</span>
<span class="source-line-no">912</span><span id="line-912"></span>
<span class="source-line-no">913</span><span id="line-913">        encodedBand = encodeBandInt("class_method_count", class_method_count, Codec.DELTA5);</span>
<span class="source-line-no">914</span><span id="line-914">        out.write(encodedBand);</span>
<span class="source-line-no">915</span><span id="line-915">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_method_count[" + class_method_count.length + "]");</span>
<span class="source-line-no">916</span><span id="line-916"></span>
<span class="source-line-no">917</span><span id="line-917">        final int totalFields = sum(class_field_count);</span>
<span class="source-line-no">918</span><span id="line-918">        final int[] fieldDescr = new int[totalFields];</span>
<span class="source-line-no">919</span><span id="line-919">        k = 0;</span>
<span class="source-line-no">920</span><span id="line-920">        for (int i = 0; i &lt; index; i++) {</span>
<span class="source-line-no">921</span><span id="line-921">            for (int j = 0; j &lt; field_descr[i].length; j++) {</span>
<span class="source-line-no">922</span><span id="line-922">                final CPNameAndType descr = field_descr[i][j];</span>
<span class="source-line-no">923</span><span id="line-923">                fieldDescr[k] = descr.getIndex();</span>
<span class="source-line-no">924</span><span id="line-924">                k++;</span>
<span class="source-line-no">925</span><span id="line-925">            }</span>
<span class="source-line-no">926</span><span id="line-926">        }</span>
<span class="source-line-no">927</span><span id="line-927"></span>
<span class="source-line-no">928</span><span id="line-928">        encodedBand = encodeBandInt("field_descr", fieldDescr, Codec.DELTA5);</span>
<span class="source-line-no">929</span><span id="line-929">        out.write(encodedBand);</span>
<span class="source-line-no">930</span><span id="line-930">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from field_descr[" + fieldDescr.length + "]");</span>
<span class="source-line-no">931</span><span id="line-931"></span>
<span class="source-line-no">932</span><span id="line-932">        writeFieldAttributeBands(out);</span>
<span class="source-line-no">933</span><span id="line-933"></span>
<span class="source-line-no">934</span><span id="line-934">        final int totalMethods = sum(class_method_count);</span>
<span class="source-line-no">935</span><span id="line-935">        final int[] methodDescr = new int[totalMethods];</span>
<span class="source-line-no">936</span><span id="line-936">        k = 0;</span>
<span class="source-line-no">937</span><span id="line-937">        for (int i = 0; i &lt; index; i++) {</span>
<span class="source-line-no">938</span><span id="line-938">            for (int j = 0; j &lt; method_descr[i].length; j++) {</span>
<span class="source-line-no">939</span><span id="line-939">                final CPNameAndType descr = method_descr[i][j];</span>
<span class="source-line-no">940</span><span id="line-940">                methodDescr[k] = descr.getIndex();</span>
<span class="source-line-no">941</span><span id="line-941">                k++;</span>
<span class="source-line-no">942</span><span id="line-942">            }</span>
<span class="source-line-no">943</span><span id="line-943">        }</span>
<span class="source-line-no">944</span><span id="line-944"></span>
<span class="source-line-no">945</span><span id="line-945">        encodedBand = encodeBandInt("method_descr", methodDescr, Codec.MDELTA5);</span>
<span class="source-line-no">946</span><span id="line-946">        out.write(encodedBand);</span>
<span class="source-line-no">947</span><span id="line-947">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from method_descr[" + methodDescr.length + "]");</span>
<span class="source-line-no">948</span><span id="line-948"></span>
<span class="source-line-no">949</span><span id="line-949">        writeMethodAttributeBands(out);</span>
<span class="source-line-no">950</span><span id="line-950">        writeClassAttributeBands(out);</span>
<span class="source-line-no">951</span><span id="line-951">        writeCodeBands(out);</span>
<span class="source-line-no">952</span><span id="line-952">    }</span>
<span class="source-line-no">953</span><span id="line-953"></span>
<span class="source-line-no">954</span><span id="line-954">    /**</span>
<span class="source-line-no">955</span><span id="line-955">     * Remove all entries for the current class</span>
<span class="source-line-no">956</span><span id="line-956">     */</span>
<span class="source-line-no">957</span><span id="line-957">    public void removeCurrentClass() {</span>
<span class="source-line-no">958</span><span id="line-958">        // Note - this doesn't remove any entries added to the constant pool but</span>
<span class="source-line-no">959</span><span id="line-959">        // that shouldn't be a problem</span>
<span class="source-line-no">960</span><span id="line-960">        if ((class_flags[index] &amp; 1 &lt;&lt; 17) != 0) {</span>
<span class="source-line-no">961</span><span id="line-961">            classSourceFile.remove(classSourceFile.size() - 1);</span>
<span class="source-line-no">962</span><span id="line-962">        }</span>
<span class="source-line-no">963</span><span id="line-963">        if ((class_flags[index] &amp; 1 &lt;&lt; 18) != 0) {</span>
<span class="source-line-no">964</span><span id="line-964">            classEnclosingMethodClass.remove(classEnclosingMethodClass.size() - 1);</span>
<span class="source-line-no">965</span><span id="line-965">            classEnclosingMethodDesc.remove(classEnclosingMethodDesc.size() - 1);</span>
<span class="source-line-no">966</span><span id="line-966">        }</span>
<span class="source-line-no">967</span><span id="line-967">        if ((class_flags[index] &amp; 1 &lt;&lt; 19) != 0) {</span>
<span class="source-line-no">968</span><span id="line-968">            classSignature.remove(classSignature.size() - 1);</span>
<span class="source-line-no">969</span><span id="line-969">        }</span>
<span class="source-line-no">970</span><span id="line-970">        if ((class_flags[index] &amp; 1 &lt;&lt; 21) != 0) {</span>
<span class="source-line-no">971</span><span id="line-971">            class_RVA_bands.removeLatest();</span>
<span class="source-line-no">972</span><span id="line-972">        }</span>
<span class="source-line-no">973</span><span id="line-973">        if ((class_flags[index] &amp; 1 &lt;&lt; 22) != 0) {</span>
<span class="source-line-no">974</span><span id="line-974">            class_RIA_bands.removeLatest();</span>
<span class="source-line-no">975</span><span id="line-975">        }</span>
<span class="source-line-no">976</span><span id="line-976">        for (final Long flagsL : tempFieldFlags) {</span>
<span class="source-line-no">977</span><span id="line-977">            final long flags = flagsL.longValue();</span>
<span class="source-line-no">978</span><span id="line-978">            if ((flags &amp; 1 &lt;&lt; 19) != 0) {</span>
<span class="source-line-no">979</span><span id="line-979">                fieldSignature.remove(fieldSignature.size() - 1);</span>
<span class="source-line-no">980</span><span id="line-980">            }</span>
<span class="source-line-no">981</span><span id="line-981">            if ((flags &amp; 1 &lt;&lt; 17) != 0) {</span>
<span class="source-line-no">982</span><span id="line-982">                fieldConstantValueKQ.remove(fieldConstantValueKQ.size() - 1);</span>
<span class="source-line-no">983</span><span id="line-983">            }</span>
<span class="source-line-no">984</span><span id="line-984">            if ((flags &amp; 1 &lt;&lt; 21) != 0) {</span>
<span class="source-line-no">985</span><span id="line-985">                field_RVA_bands.removeLatest();</span>
<span class="source-line-no">986</span><span id="line-986">            }</span>
<span class="source-line-no">987</span><span id="line-987">            if ((flags &amp; 1 &lt;&lt; 22) != 0) {</span>
<span class="source-line-no">988</span><span id="line-988">                field_RIA_bands.removeLatest();</span>
<span class="source-line-no">989</span><span id="line-989">            }</span>
<span class="source-line-no">990</span><span id="line-990">        }</span>
<span class="source-line-no">991</span><span id="line-991">        for (final Long flagsL : tempMethodFlags) {</span>
<span class="source-line-no">992</span><span id="line-992">            final long flags = flagsL.longValue();</span>
<span class="source-line-no">993</span><span id="line-993">            if ((flags &amp; 1 &lt;&lt; 19) != 0) {</span>
<span class="source-line-no">994</span><span id="line-994">                methodSignature.remove(methodSignature.size() - 1);</span>
<span class="source-line-no">995</span><span id="line-995">            }</span>
<span class="source-line-no">996</span><span id="line-996">            if ((flags &amp; 1 &lt;&lt; 18) != 0) {</span>
<span class="source-line-no">997</span><span id="line-997">                final int exceptions = methodExceptionNumber.remove(methodExceptionNumber.size() - 1);</span>
<span class="source-line-no">998</span><span id="line-998">                for (int i = 0; i &lt; exceptions; i++) {</span>
<span class="source-line-no">999</span><span id="line-999">                    methodExceptionClasses.remove(methodExceptionClasses.size() - 1);</span>
<span class="source-line-no">1000</span><span id="line-1000">                }</span>
<span class="source-line-no">1001</span><span id="line-1001">            }</span>
<span class="source-line-no">1002</span><span id="line-1002">            if ((flags &amp; 1 &lt;&lt; 17) != 0) { // has code attribute</span>
<span class="source-line-no">1003</span><span id="line-1003">                codeMaxLocals.remove(codeMaxLocals.size() - 1);</span>
<span class="source-line-no">1004</span><span id="line-1004">                codeMaxStack.remove(codeMaxStack.size() - 1);</span>
<span class="source-line-no">1005</span><span id="line-1005">                final int handlers = codeHandlerCount.remove(codeHandlerCount.size() - 1);</span>
<span class="source-line-no">1006</span><span id="line-1006">                for (int i = 0; i &lt; handlers; i++) {</span>
<span class="source-line-no">1007</span><span id="line-1007">                    final int index = codeHandlerStartP.size() - 1;</span>
<span class="source-line-no">1008</span><span id="line-1008">                    codeHandlerStartP.remove(index);</span>
<span class="source-line-no">1009</span><span id="line-1009">                    codeHandlerEndPO.remove(index);</span>
<span class="source-line-no">1010</span><span id="line-1010">                    codeHandlerCatchPO.remove(index);</span>
<span class="source-line-no">1011</span><span id="line-1011">                    codeHandlerClass.remove(index);</span>
<span class="source-line-no">1012</span><span id="line-1012">                }</span>
<span class="source-line-no">1013</span><span id="line-1013">                if (!stripDebug) {</span>
<span class="source-line-no">1014</span><span id="line-1014">                    final long cdeFlags = codeFlags.remove(codeFlags.size() - 1).longValue();</span>
<span class="source-line-no">1015</span><span id="line-1015">                    final int numLocalVariables = codeLocalVariableTableN.remove(codeLocalVariableTableN.size() - 1);</span>
<span class="source-line-no">1016</span><span id="line-1016">                    for (int i = 0; i &lt; numLocalVariables; i++) {</span>
<span class="source-line-no">1017</span><span id="line-1017">                        final int location = codeLocalVariableTableBciP.size() - 1;</span>
<span class="source-line-no">1018</span><span id="line-1018">                        codeLocalVariableTableBciP.remove(location);</span>
<span class="source-line-no">1019</span><span id="line-1019">                        codeLocalVariableTableSpanO.remove(location);</span>
<span class="source-line-no">1020</span><span id="line-1020">                        codeLocalVariableTableNameRU.remove(location);</span>
<span class="source-line-no">1021</span><span id="line-1021">                        codeLocalVariableTableTypeRS.remove(location);</span>
<span class="source-line-no">1022</span><span id="line-1022">                        codeLocalVariableTableSlot.remove(location);</span>
<span class="source-line-no">1023</span><span id="line-1023">                    }</span>
<span class="source-line-no">1024</span><span id="line-1024">                    if ((cdeFlags &amp; 1 &lt;&lt; 3) != 0) {</span>
<span class="source-line-no">1025</span><span id="line-1025">                        final int numLocalVariablesInTypeTable = codeLocalVariableTypeTableN.remove(codeLocalVariableTypeTableN.size() - 1);</span>
<span class="source-line-no">1026</span><span id="line-1026">                        for (int i = 0; i &lt; numLocalVariablesInTypeTable; i++) {</span>
<span class="source-line-no">1027</span><span id="line-1027">                            final int location = codeLocalVariableTypeTableBciP.size() - 1;</span>
<span class="source-line-no">1028</span><span id="line-1028">                            codeLocalVariableTypeTableBciP.remove(location);</span>
<span class="source-line-no">1029</span><span id="line-1029">                            codeLocalVariableTypeTableSpanO.remove(location);</span>
<span class="source-line-no">1030</span><span id="line-1030">                            codeLocalVariableTypeTableNameRU.remove(location);</span>
<span class="source-line-no">1031</span><span id="line-1031">                            codeLocalVariableTypeTableTypeRS.remove(location);</span>
<span class="source-line-no">1032</span><span id="line-1032">                            codeLocalVariableTypeTableSlot.remove(location);</span>
<span class="source-line-no">1033</span><span id="line-1033">                        }</span>
<span class="source-line-no">1034</span><span id="line-1034">                    }</span>
<span class="source-line-no">1035</span><span id="line-1035">                    if ((cdeFlags &amp; 1 &lt;&lt; 1) != 0) {</span>
<span class="source-line-no">1036</span><span id="line-1036">                        final int numLineNumbers = codeLineNumberTableN.remove(codeLineNumberTableN.size() - 1);</span>
<span class="source-line-no">1037</span><span id="line-1037">                        for (int i = 0; i &lt; numLineNumbers; i++) {</span>
<span class="source-line-no">1038</span><span id="line-1038">                            final int location = codeLineNumberTableBciP.size() - 1;</span>
<span class="source-line-no">1039</span><span id="line-1039">                            codeLineNumberTableBciP.remove(location);</span>
<span class="source-line-no">1040</span><span id="line-1040">                            codeLineNumberTableLine.remove(location);</span>
<span class="source-line-no">1041</span><span id="line-1041">                        }</span>
<span class="source-line-no">1042</span><span id="line-1042">                    }</span>
<span class="source-line-no">1043</span><span id="line-1043">                }</span>
<span class="source-line-no">1044</span><span id="line-1044">            }</span>
<span class="source-line-no">1045</span><span id="line-1045">            if ((flags &amp; 1 &lt;&lt; 21) != 0) {</span>
<span class="source-line-no">1046</span><span id="line-1046">                method_RVA_bands.removeLatest();</span>
<span class="source-line-no">1047</span><span id="line-1047">            }</span>
<span class="source-line-no">1048</span><span id="line-1048">            if ((flags &amp; 1 &lt;&lt; 22) != 0) {</span>
<span class="source-line-no">1049</span><span id="line-1049">                method_RIA_bands.removeLatest();</span>
<span class="source-line-no">1050</span><span id="line-1050">            }</span>
<span class="source-line-no">1051</span><span id="line-1051">            if ((flags &amp; 1 &lt;&lt; 23) != 0) {</span>
<span class="source-line-no">1052</span><span id="line-1052">                method_RVPA_bands.removeLatest();</span>
<span class="source-line-no">1053</span><span id="line-1053">            }</span>
<span class="source-line-no">1054</span><span id="line-1054">            if ((flags &amp; 1 &lt;&lt; 24) != 0) {</span>
<span class="source-line-no">1055</span><span id="line-1055">                method_RIPA_bands.removeLatest();</span>
<span class="source-line-no">1056</span><span id="line-1056">            }</span>
<span class="source-line-no">1057</span><span id="line-1057">            if ((flags &amp; 1 &lt;&lt; 25) != 0) {</span>
<span class="source-line-no">1058</span><span id="line-1058">                method_AD_bands.removeLatest();</span>
<span class="source-line-no">1059</span><span id="line-1059">            }</span>
<span class="source-line-no">1060</span><span id="line-1060">        }</span>
<span class="source-line-no">1061</span><span id="line-1061">        class_this[index] = null;</span>
<span class="source-line-no">1062</span><span id="line-1062">        class_super[index] = null;</span>
<span class="source-line-no">1063</span><span id="line-1063">        class_interface_count[index] = 0;</span>
<span class="source-line-no">1064</span><span id="line-1064">        class_interface[index] = null;</span>
<span class="source-line-no">1065</span><span id="line-1065">        major_versions[index] = 0;</span>
<span class="source-line-no">1066</span><span id="line-1066">        class_flags[index] = 0;</span>
<span class="source-line-no">1067</span><span id="line-1067">        tempFieldDesc.clear();</span>
<span class="source-line-no">1068</span><span id="line-1068">        tempFieldFlags.clear();</span>
<span class="source-line-no">1069</span><span id="line-1069">        tempMethodDesc.clear();</span>
<span class="source-line-no">1070</span><span id="line-1070">        tempMethodFlags.clear();</span>
<span class="source-line-no">1071</span><span id="line-1071">        if (index &gt; 0) {</span>
<span class="source-line-no">1072</span><span id="line-1072">            index--;</span>
<span class="source-line-no">1073</span><span id="line-1073">        }</span>
<span class="source-line-no">1074</span><span id="line-1074">    }</span>
<span class="source-line-no">1075</span><span id="line-1075"></span>
<span class="source-line-no">1076</span><span id="line-1076">    private void renumberBci(final List&lt;Integer&gt; list, final IntList bciRenumbering, final Map&lt;Label, Integer&gt; labelsToOffsets) {</span>
<span class="source-line-no">1077</span><span id="line-1077">        for (int i = list.size() - 1; i &gt;= 0; i--) {</span>
<span class="source-line-no">1078</span><span id="line-1078">            final Object label = list.get(i);</span>
<span class="source-line-no">1079</span><span id="line-1079">            if (label instanceof Integer) {</span>
<span class="source-line-no">1080</span><span id="line-1080">                break;</span>
<span class="source-line-no">1081</span><span id="line-1081">            }</span>
<span class="source-line-no">1082</span><span id="line-1082">            if (label instanceof Label) {</span>
<span class="source-line-no">1083</span><span id="line-1083">                list.remove(i);</span>
<span class="source-line-no">1084</span><span id="line-1084">                final Integer bytecodeIndex = labelsToOffsets.get(label);</span>
<span class="source-line-no">1085</span><span id="line-1085">                list.add(i, Integer.valueOf(bciRenumbering.get(bytecodeIndex.intValue())));</span>
<span class="source-line-no">1086</span><span id="line-1086">            }</span>
<span class="source-line-no">1087</span><span id="line-1087">        }</span>
<span class="source-line-no">1088</span><span id="line-1088">    }</span>
<span class="source-line-no">1089</span><span id="line-1089"></span>
<span class="source-line-no">1090</span><span id="line-1090">    private void renumberDoubleOffsetBci(final List&lt;Integer&gt; relative, final List&lt;Integer&gt; firstOffset, final List&lt;Object&gt; list, final IntList bciRenumbering,</span>
<span class="source-line-no">1091</span><span id="line-1091">            final Map&lt;Label, Integer&gt; labelsToOffsets) {</span>
<span class="source-line-no">1092</span><span id="line-1092">        // TODO: There's probably a nicer way of doing this...</span>
<span class="source-line-no">1093</span><span id="line-1093">        for (int i = list.size() - 1; i &gt;= 0; i--) {</span>
<span class="source-line-no">1094</span><span id="line-1094">            final Object label = list.get(i);</span>
<span class="source-line-no">1095</span><span id="line-1095">            if (label instanceof Integer) {</span>
<span class="source-line-no">1096</span><span id="line-1096">                break;</span>
<span class="source-line-no">1097</span><span id="line-1097">            }</span>
<span class="source-line-no">1098</span><span id="line-1098">            if (label instanceof Label) {</span>
<span class="source-line-no">1099</span><span id="line-1099">                list.remove(i);</span>
<span class="source-line-no">1100</span><span id="line-1100">                final Integer bytecodeIndex = labelsToOffsets.get(label);</span>
<span class="source-line-no">1101</span><span id="line-1101">                final Integer renumberedOffset = Integer</span>
<span class="source-line-no">1102</span><span id="line-1102">                        .valueOf(bciRenumbering.get(bytecodeIndex.intValue()) - relative.get(i).intValue() - firstOffset.get(i).intValue());</span>
<span class="source-line-no">1103</span><span id="line-1103">                list.add(i, renumberedOffset);</span>
<span class="source-line-no">1104</span><span id="line-1104">            }</span>
<span class="source-line-no">1105</span><span id="line-1105">        }</span>
<span class="source-line-no">1106</span><span id="line-1106">    }</span>
<span class="source-line-no">1107</span><span id="line-1107"></span>
<span class="source-line-no">1108</span><span id="line-1108">    private void renumberOffsetBci(final List&lt;Integer&gt; relative, final List&lt;Integer&gt; list, final IntList bciRenumbering,</span>
<span class="source-line-no">1109</span><span id="line-1109">            final Map&lt;Label, Integer&gt; labelsToOffsets) {</span>
<span class="source-line-no">1110</span><span id="line-1110">        for (int i = list.size() - 1; i &gt;= 0; i--) {</span>
<span class="source-line-no">1111</span><span id="line-1111">            final Object label = list.get(i);</span>
<span class="source-line-no">1112</span><span id="line-1112">            if (label instanceof Integer) {</span>
<span class="source-line-no">1113</span><span id="line-1113">                break;</span>
<span class="source-line-no">1114</span><span id="line-1114">            }</span>
<span class="source-line-no">1115</span><span id="line-1115">            if (label instanceof Label) {</span>
<span class="source-line-no">1116</span><span id="line-1116">                list.remove(i);</span>
<span class="source-line-no">1117</span><span id="line-1117">                final Integer bytecodeIndex = labelsToOffsets.get(label);</span>
<span class="source-line-no">1118</span><span id="line-1118">                final Integer renumberedOffset = Integer.valueOf(bciRenumbering.get(bytecodeIndex.intValue()) - relative.get(i).intValue());</span>
<span class="source-line-no">1119</span><span id="line-1119">                list.add(i, renumberedOffset);</span>
<span class="source-line-no">1120</span><span id="line-1120">            }</span>
<span class="source-line-no">1121</span><span id="line-1121">        }</span>
<span class="source-line-no">1122</span><span id="line-1122">    }</span>
<span class="source-line-no">1123</span><span id="line-1123"></span>
<span class="source-line-no">1124</span><span id="line-1124">    private int sum(final int[] ints) {</span>
<span class="source-line-no">1125</span><span id="line-1125">        int sum = 0;</span>
<span class="source-line-no">1126</span><span id="line-1126">        for (final int j : ints) {</span>
<span class="source-line-no">1127</span><span id="line-1127">            sum += j;</span>
<span class="source-line-no">1128</span><span id="line-1128">        }</span>
<span class="source-line-no">1129</span><span id="line-1129">        return sum;</span>
<span class="source-line-no">1130</span><span id="line-1130">    }</span>
<span class="source-line-no">1131</span><span id="line-1131"></span>
<span class="source-line-no">1132</span><span id="line-1132">    private void writeClassAttributeBands(final OutputStream out) throws IOException, Pack200Exception {</span>
<span class="source-line-no">1133</span><span id="line-1133">        byte[] encodedBand = encodeFlags("class_flags", class_flags, Codec.UNSIGNED5, Codec.UNSIGNED5, segmentHeader.have_class_flags_hi());</span>
<span class="source-line-no">1134</span><span id="line-1134">        out.write(encodedBand);</span>
<span class="source-line-no">1135</span><span id="line-1135">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_flags[" + class_flags.length + "]");</span>
<span class="source-line-no">1136</span><span id="line-1136"></span>
<span class="source-line-no">1137</span><span id="line-1137">        // These bands are not needed, but could be used to reduce the size of</span>
<span class="source-line-no">1138</span><span id="line-1138">        // the archive if there are enough different non-standard attributes</span>
<span class="source-line-no">1139</span><span id="line-1139">        // defined that segmentHeader.have_class_flags_hi() is true. The same</span>
<span class="source-line-no">1140</span><span id="line-1140">        // applies to method_attr_count, field_attr_count, code_attr_count etc.</span>
<span class="source-line-no">1141</span><span id="line-1141"></span>
<span class="source-line-no">1142</span><span id="line-1142">        // *class_attr_count :UNSIGNED5 [COUNT(1&lt;&lt;16,...)]</span>
<span class="source-line-no">1143</span><span id="line-1143">        // *class_attr_indexes :UNSIGNED5 [SUM(*class_attr_count)]</span>
<span class="source-line-no">1144</span><span id="line-1144"></span>
<span class="source-line-no">1145</span><span id="line-1145">        encodedBand = encodeBandInt("class_attr_calls", class_attr_calls, Codec.UNSIGNED5);</span>
<span class="source-line-no">1146</span><span id="line-1146">        out.write(encodedBand);</span>
<span class="source-line-no">1147</span><span id="line-1147">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_attr_calls[" + class_attr_calls.length + "]");</span>
<span class="source-line-no">1148</span><span id="line-1148"></span>
<span class="source-line-no">1149</span><span id="line-1149">        encodedBand = encodeBandInt("classSourceFile", cpEntryOrNullListToArray(classSourceFile), Codec.UNSIGNED5);</span>
<span class="source-line-no">1150</span><span id="line-1150">        out.write(encodedBand);</span>
<span class="source-line-no">1151</span><span id="line-1151">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from classSourceFile[" + classSourceFile.size() + "]");</span>
<span class="source-line-no">1152</span><span id="line-1152"></span>
<span class="source-line-no">1153</span><span id="line-1153">        encodedBand = encodeBandInt("class_enclosing_method_RC", cpEntryListToArray(classEnclosingMethodClass), Codec.UNSIGNED5);</span>
<span class="source-line-no">1154</span><span id="line-1154">        out.write(encodedBand);</span>
<span class="source-line-no">1155</span><span id="line-1155">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_enclosing_method_RC[" + classEnclosingMethodClass.size() + "]");</span>
<span class="source-line-no">1156</span><span id="line-1156"></span>
<span class="source-line-no">1157</span><span id="line-1157">        encodedBand = encodeBandInt("class_EnclosingMethod_RDN", cpEntryOrNullListToArray(classEnclosingMethodDesc), Codec.UNSIGNED5);</span>
<span class="source-line-no">1158</span><span id="line-1158">        out.write(encodedBand);</span>
<span class="source-line-no">1159</span><span id="line-1159">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_EnclosingMethod_RDN[" + classEnclosingMethodDesc.size() + "]");</span>
<span class="source-line-no">1160</span><span id="line-1160"></span>
<span class="source-line-no">1161</span><span id="line-1161">        encodedBand = encodeBandInt("class_Signature_RS", cpEntryListToArray(classSignature), Codec.UNSIGNED5);</span>
<span class="source-line-no">1162</span><span id="line-1162">        out.write(encodedBand);</span>
<span class="source-line-no">1163</span><span id="line-1163">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_Signature_RS[" + classSignature.size() + "]");</span>
<span class="source-line-no">1164</span><span id="line-1164"></span>
<span class="source-line-no">1165</span><span id="line-1165">        class_RVA_bands.pack(out);</span>
<span class="source-line-no">1166</span><span id="line-1166">        class_RIA_bands.pack(out);</span>
<span class="source-line-no">1167</span><span id="line-1167"></span>
<span class="source-line-no">1168</span><span id="line-1168">        encodedBand = encodeBandInt("class_InnerClasses_N", class_InnerClasses_N, Codec.UNSIGNED5);</span>
<span class="source-line-no">1169</span><span id="line-1169">        out.write(encodedBand);</span>
<span class="source-line-no">1170</span><span id="line-1170">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_InnerClasses_N[" + class_InnerClasses_N.length + "]");</span>
<span class="source-line-no">1171</span><span id="line-1171"></span>
<span class="source-line-no">1172</span><span id="line-1172">        encodedBand = encodeBandInt("class_InnerClasses_RC", getInts(class_InnerClasses_RC), Codec.UNSIGNED5);</span>
<span class="source-line-no">1173</span><span id="line-1173">        out.write(encodedBand);</span>
<span class="source-line-no">1174</span><span id="line-1174">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_InnerClasses_RC[" + class_InnerClasses_RC.length + "]");</span>
<span class="source-line-no">1175</span><span id="line-1175"></span>
<span class="source-line-no">1176</span><span id="line-1176">        encodedBand = encodeBandInt("class_InnerClasses_F", class_InnerClasses_F, Codec.UNSIGNED5);</span>
<span class="source-line-no">1177</span><span id="line-1177">        out.write(encodedBand);</span>
<span class="source-line-no">1178</span><span id="line-1178">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_InnerClasses_F[" + class_InnerClasses_F.length + "]");</span>
<span class="source-line-no">1179</span><span id="line-1179"></span>
<span class="source-line-no">1180</span><span id="line-1180">        encodedBand = encodeBandInt("class_InnerClasses_outer_RCN", cpEntryOrNullListToArray(classInnerClassesOuterRCN), Codec.UNSIGNED5);</span>
<span class="source-line-no">1181</span><span id="line-1181">        out.write(encodedBand);</span>
<span class="source-line-no">1182</span><span id="line-1182">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_InnerClasses_outer_RCN[" + classInnerClassesOuterRCN.size() + "]");</span>
<span class="source-line-no">1183</span><span id="line-1183"></span>
<span class="source-line-no">1184</span><span id="line-1184">        encodedBand = encodeBandInt("class_InnerClasses_name_RUN", cpEntryOrNullListToArray(classInnerClassesNameRUN), Codec.UNSIGNED5);</span>
<span class="source-line-no">1185</span><span id="line-1185">        out.write(encodedBand);</span>
<span class="source-line-no">1186</span><span id="line-1186">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from class_InnerClasses_name_RUN[" + classInnerClassesNameRUN.size() + "]");</span>
<span class="source-line-no">1187</span><span id="line-1187"></span>
<span class="source-line-no">1188</span><span id="line-1188">        encodedBand = encodeBandInt("classFileVersionMinor", classFileVersionMinor.toArray(), Codec.UNSIGNED5);</span>
<span class="source-line-no">1189</span><span id="line-1189">        out.write(encodedBand);</span>
<span class="source-line-no">1190</span><span id="line-1190">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from classFileVersionMinor[" + classFileVersionMinor.size() + "]");</span>
<span class="source-line-no">1191</span><span id="line-1191"></span>
<span class="source-line-no">1192</span><span id="line-1192">        encodedBand = encodeBandInt("classFileVersionMajor", classFileVersionMajor.toArray(), Codec.UNSIGNED5);</span>
<span class="source-line-no">1193</span><span id="line-1193">        out.write(encodedBand);</span>
<span class="source-line-no">1194</span><span id="line-1194">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from classFileVersionMajor[" + classFileVersionMajor.size() + "]");</span>
<span class="source-line-no">1195</span><span id="line-1195"></span>
<span class="source-line-no">1196</span><span id="line-1196">        for (final NewAttributeBands classAttributeBand : classAttributeBands) {</span>
<span class="source-line-no">1197</span><span id="line-1197">            classAttributeBand.pack(out);</span>
<span class="source-line-no">1198</span><span id="line-1198">        }</span>
<span class="source-line-no">1199</span><span id="line-1199">    }</span>
<span class="source-line-no">1200</span><span id="line-1200"></span>
<span class="source-line-no">1201</span><span id="line-1201">    private void writeCodeAttributeBands(final OutputStream out) throws IOException, Pack200Exception {</span>
<span class="source-line-no">1202</span><span id="line-1202">        byte[] encodedBand = encodeFlags("codeFlags", longListToArray(codeFlags), Codec.UNSIGNED5, Codec.UNSIGNED5, segmentHeader.have_code_flags_hi());</span>
<span class="source-line-no">1203</span><span id="line-1203">        out.write(encodedBand);</span>
<span class="source-line-no">1204</span><span id="line-1204">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from codeFlags[" + codeFlags.size() + "]");</span>
<span class="source-line-no">1205</span><span id="line-1205"></span>
<span class="source-line-no">1206</span><span id="line-1206">        // *code_attr_count :UNSIGNED5 [COUNT(1&lt;&lt;16,...)]</span>
<span class="source-line-no">1207</span><span id="line-1207">        // *code_attr_indexes :UNSIGNED5 [SUM(*code_attr_count)]</span>
<span class="source-line-no">1208</span><span id="line-1208">        encodedBand = encodeBandInt("code_attr_calls", code_attr_calls, Codec.UNSIGNED5);</span>
<span class="source-line-no">1209</span><span id="line-1209">        out.write(encodedBand);</span>
<span class="source-line-no">1210</span><span id="line-1210">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_attr_calls[" + code_attr_calls.length + "]");</span>
<span class="source-line-no">1211</span><span id="line-1211"></span>
<span class="source-line-no">1212</span><span id="line-1212">        encodedBand = encodeBandInt("code_LineNumberTable_N", codeLineNumberTableN.toArray(), Codec.UNSIGNED5);</span>
<span class="source-line-no">1213</span><span id="line-1213">        out.write(encodedBand);</span>
<span class="source-line-no">1214</span><span id="line-1214">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LineNumberTable_N[" + codeLineNumberTableN.size() + "]");</span>
<span class="source-line-no">1215</span><span id="line-1215"></span>
<span class="source-line-no">1216</span><span id="line-1216">        encodedBand = encodeBandInt("code_LineNumberTable_bci_P", integerListToArray(codeLineNumberTableBciP), Codec.BCI5);</span>
<span class="source-line-no">1217</span><span id="line-1217">        out.write(encodedBand);</span>
<span class="source-line-no">1218</span><span id="line-1218">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LineNumberTable_bci_P[" + codeLineNumberTableBciP.size() + "]");</span>
<span class="source-line-no">1219</span><span id="line-1219"></span>
<span class="source-line-no">1220</span><span id="line-1220">        encodedBand = encodeBandInt("code_LineNumberTable_line", codeLineNumberTableLine.toArray(), Codec.UNSIGNED5);</span>
<span class="source-line-no">1221</span><span id="line-1221">        out.write(encodedBand);</span>
<span class="source-line-no">1222</span><span id="line-1222">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LineNumberTable_line[" + codeLineNumberTableLine.size() + "]");</span>
<span class="source-line-no">1223</span><span id="line-1223"></span>
<span class="source-line-no">1224</span><span id="line-1224">        encodedBand = encodeBandInt("code_LocalVariableTable_N", codeLocalVariableTableN.toArray(), Codec.UNSIGNED5);</span>
<span class="source-line-no">1225</span><span id="line-1225">        out.write(encodedBand);</span>
<span class="source-line-no">1226</span><span id="line-1226">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LocalVariableTable_N[" + codeLocalVariableTableN.size() + "]");</span>
<span class="source-line-no">1227</span><span id="line-1227"></span>
<span class="source-line-no">1228</span><span id="line-1228">        encodedBand = encodeBandInt("code_LocalVariableTable_bci_P", integerListToArray(codeLocalVariableTableBciP), Codec.BCI5);</span>
<span class="source-line-no">1229</span><span id="line-1229">        out.write(encodedBand);</span>
<span class="source-line-no">1230</span><span id="line-1230">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LocalVariableTable_bci_P[" + codeLocalVariableTableBciP.size() + "]");</span>
<span class="source-line-no">1231</span><span id="line-1231"></span>
<span class="source-line-no">1232</span><span id="line-1232">        encodedBand = encodeBandInt("code_LocalVariableTable_span_O", integerListToArray(codeLocalVariableTableSpanO), Codec.BRANCH5);</span>
<span class="source-line-no">1233</span><span id="line-1233">        out.write(encodedBand);</span>
<span class="source-line-no">1234</span><span id="line-1234">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LocalVariableTable_span_O[" + codeLocalVariableTableSpanO.size() + "]");</span>
<span class="source-line-no">1235</span><span id="line-1235"></span>
<span class="source-line-no">1236</span><span id="line-1236">        encodedBand = encodeBandInt("code_LocalVariableTable_name_RU", cpEntryListToArray(codeLocalVariableTableNameRU), Codec.UNSIGNED5);</span>
<span class="source-line-no">1237</span><span id="line-1237">        out.write(encodedBand);</span>
<span class="source-line-no">1238</span><span id="line-1238">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LocalVariableTable_name_RU[" + codeLocalVariableTableNameRU.size() + "]");</span>
<span class="source-line-no">1239</span><span id="line-1239"></span>
<span class="source-line-no">1240</span><span id="line-1240">        encodedBand = encodeBandInt("code_LocalVariableTable_type_RS", cpEntryListToArray(codeLocalVariableTableTypeRS), Codec.UNSIGNED5);</span>
<span class="source-line-no">1241</span><span id="line-1241">        out.write(encodedBand);</span>
<span class="source-line-no">1242</span><span id="line-1242">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LocalVariableTable_type_RS[" + codeLocalVariableTableTypeRS.size() + "]");</span>
<span class="source-line-no">1243</span><span id="line-1243"></span>
<span class="source-line-no">1244</span><span id="line-1244">        encodedBand = encodeBandInt("code_LocalVariableTable_slot", codeLocalVariableTableSlot.toArray(), Codec.UNSIGNED5);</span>
<span class="source-line-no">1245</span><span id="line-1245">        out.write(encodedBand);</span>
<span class="source-line-no">1246</span><span id="line-1246">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LocalVariableTable_slot[" + codeLocalVariableTableSlot.size() + "]");</span>
<span class="source-line-no">1247</span><span id="line-1247"></span>
<span class="source-line-no">1248</span><span id="line-1248">        encodedBand = encodeBandInt("code_LocalVariableTypeTable_N", codeLocalVariableTypeTableN.toArray(), Codec.UNSIGNED5);</span>
<span class="source-line-no">1249</span><span id="line-1249">        out.write(encodedBand);</span>
<span class="source-line-no">1250</span><span id="line-1250">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LocalVariableTypeTable_N[" + codeLocalVariableTypeTableN.size() + "]");</span>
<span class="source-line-no">1251</span><span id="line-1251"></span>
<span class="source-line-no">1252</span><span id="line-1252">        encodedBand = encodeBandInt("code_LocalVariableTypeTable_bci_P", integerListToArray(codeLocalVariableTypeTableBciP), Codec.BCI5);</span>
<span class="source-line-no">1253</span><span id="line-1253">        out.write(encodedBand);</span>
<span class="source-line-no">1254</span><span id="line-1254">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LocalVariableTypeTable_bci_P[" + codeLocalVariableTypeTableBciP.size() + "]");</span>
<span class="source-line-no">1255</span><span id="line-1255"></span>
<span class="source-line-no">1256</span><span id="line-1256">        encodedBand = encodeBandInt("code_LocalVariableTypeTable_span_O", integerListToArray(codeLocalVariableTypeTableSpanO), Codec.BRANCH5);</span>
<span class="source-line-no">1257</span><span id="line-1257">        out.write(encodedBand);</span>
<span class="source-line-no">1258</span><span id="line-1258">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LocalVariableTypeTable_span_O[" + codeLocalVariableTypeTableSpanO.size() + "]");</span>
<span class="source-line-no">1259</span><span id="line-1259"></span>
<span class="source-line-no">1260</span><span id="line-1260">        encodedBand = encodeBandInt("code_LocalVariableTypeTable_name_RU", cpEntryListToArray(codeLocalVariableTypeTableNameRU), Codec.UNSIGNED5);</span>
<span class="source-line-no">1261</span><span id="line-1261">        out.write(encodedBand);</span>
<span class="source-line-no">1262</span><span id="line-1262">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LocalVariableTypeTable_name_RU[" + codeLocalVariableTypeTableNameRU.size() + "]");</span>
<span class="source-line-no">1263</span><span id="line-1263"></span>
<span class="source-line-no">1264</span><span id="line-1264">        encodedBand = encodeBandInt("code_LocalVariableTypeTable_type_RS", cpEntryListToArray(codeLocalVariableTypeTableTypeRS), Codec.UNSIGNED5);</span>
<span class="source-line-no">1265</span><span id="line-1265">        out.write(encodedBand);</span>
<span class="source-line-no">1266</span><span id="line-1266">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LocalVariableTypeTable_type_RS[" + codeLocalVariableTypeTableTypeRS.size() + "]");</span>
<span class="source-line-no">1267</span><span id="line-1267"></span>
<span class="source-line-no">1268</span><span id="line-1268">        encodedBand = encodeBandInt("code_LocalVariableTypeTable_slot", codeLocalVariableTypeTableSlot.toArray(), Codec.UNSIGNED5);</span>
<span class="source-line-no">1269</span><span id="line-1269">        out.write(encodedBand);</span>
<span class="source-line-no">1270</span><span id="line-1270">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from code_LocalVariableTypeTable_slot[" + codeLocalVariableTypeTableSlot.size() + "]");</span>
<span class="source-line-no">1271</span><span id="line-1271"></span>
<span class="source-line-no">1272</span><span id="line-1272">        for (final NewAttributeBands bands : codeAttributeBands) {</span>
<span class="source-line-no">1273</span><span id="line-1273">            bands.pack(out);</span>
<span class="source-line-no">1274</span><span id="line-1274">        }</span>
<span class="source-line-no">1275</span><span id="line-1275">    }</span>
<span class="source-line-no">1276</span><span id="line-1276"></span>
<span class="source-line-no">1277</span><span id="line-1277">    private void writeCodeBands(final OutputStream out) throws IOException, Pack200Exception {</span>
<span class="source-line-no">1278</span><span id="line-1278">        byte[] encodedBand = encodeBandInt("codeHeaders", codeHeaders, Codec.BYTE1);</span>
<span class="source-line-no">1279</span><span id="line-1279">        out.write(encodedBand);</span>
<span class="source-line-no">1280</span><span id="line-1280">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from codeHeaders[" + codeHeaders.length + "]");</span>
<span class="source-line-no">1281</span><span id="line-1281"></span>
<span class="source-line-no">1282</span><span id="line-1282">        encodedBand = encodeBandInt("codeMaxStack", codeMaxStack.toArray(), Codec.UNSIGNED5);</span>
<span class="source-line-no">1283</span><span id="line-1283">        out.write(encodedBand);</span>
<span class="source-line-no">1284</span><span id="line-1284">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from codeMaxStack[" + codeMaxStack.size() + "]");</span>
<span class="source-line-no">1285</span><span id="line-1285"></span>
<span class="source-line-no">1286</span><span id="line-1286">        encodedBand = encodeBandInt("codeMaxLocals", codeMaxLocals.toArray(), Codec.UNSIGNED5);</span>
<span class="source-line-no">1287</span><span id="line-1287">        out.write(encodedBand);</span>
<span class="source-line-no">1288</span><span id="line-1288">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from codeMaxLocals[" + codeMaxLocals.size() + "]");</span>
<span class="source-line-no">1289</span><span id="line-1289"></span>
<span class="source-line-no">1290</span><span id="line-1290">        encodedBand = encodeBandInt("codeHandlerCount", codeHandlerCount.toArray(), Codec.UNSIGNED5);</span>
<span class="source-line-no">1291</span><span id="line-1291">        out.write(encodedBand);</span>
<span class="source-line-no">1292</span><span id="line-1292">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from codeHandlerCount[" + codeHandlerCount.size() + "]");</span>
<span class="source-line-no">1293</span><span id="line-1293"></span>
<span class="source-line-no">1294</span><span id="line-1294">        encodedBand = encodeBandInt("codeHandlerStartP", integerListToArray(codeHandlerStartP), Codec.BCI5);</span>
<span class="source-line-no">1295</span><span id="line-1295">        out.write(encodedBand);</span>
<span class="source-line-no">1296</span><span id="line-1296">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from codeHandlerStartP[" + codeHandlerStartP.size() + "]");</span>
<span class="source-line-no">1297</span><span id="line-1297"></span>
<span class="source-line-no">1298</span><span id="line-1298">        encodedBand = encodeBandInt("codeHandlerEndPO", integerListToArray(codeHandlerEndPO), Codec.BRANCH5);</span>
<span class="source-line-no">1299</span><span id="line-1299">        out.write(encodedBand);</span>
<span class="source-line-no">1300</span><span id="line-1300">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from codeHandlerEndPO[" + codeHandlerEndPO.size() + "]");</span>
<span class="source-line-no">1301</span><span id="line-1301"></span>
<span class="source-line-no">1302</span><span id="line-1302">        encodedBand = encodeBandInt("codeHandlerCatchPO", integerListToArray(codeHandlerCatchPO), Codec.BRANCH5);</span>
<span class="source-line-no">1303</span><span id="line-1303">        out.write(encodedBand);</span>
<span class="source-line-no">1304</span><span id="line-1304">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from codeHandlerCatchPO[" + codeHandlerCatchPO.size() + "]");</span>
<span class="source-line-no">1305</span><span id="line-1305"></span>
<span class="source-line-no">1306</span><span id="line-1306">        encodedBand = encodeBandInt("codeHandlerClass", cpEntryOrNullListToArray(codeHandlerClass), Codec.UNSIGNED5);</span>
<span class="source-line-no">1307</span><span id="line-1307">        out.write(encodedBand);</span>
<span class="source-line-no">1308</span><span id="line-1308">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from codeHandlerClass[" + codeHandlerClass.size() + "]");</span>
<span class="source-line-no">1309</span><span id="line-1309"></span>
<span class="source-line-no">1310</span><span id="line-1310">        writeCodeAttributeBands(out);</span>
<span class="source-line-no">1311</span><span id="line-1311">    }</span>
<span class="source-line-no">1312</span><span id="line-1312"></span>
<span class="source-line-no">1313</span><span id="line-1313">    private void writeFieldAttributeBands(final OutputStream out) throws IOException, Pack200Exception {</span>
<span class="source-line-no">1314</span><span id="line-1314">        byte[] encodedBand = encodeFlags("field_flags", field_flags, Codec.UNSIGNED5, Codec.UNSIGNED5, segmentHeader.have_field_flags_hi());</span>
<span class="source-line-no">1315</span><span id="line-1315">        out.write(encodedBand);</span>
<span class="source-line-no">1316</span><span id="line-1316">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from field_flags[" + field_flags.length + "]");</span>
<span class="source-line-no">1317</span><span id="line-1317"></span>
<span class="source-line-no">1318</span><span id="line-1318">        // *field_attr_count :UNSIGNED5 [COUNT(1&lt;&lt;16,...)]</span>
<span class="source-line-no">1319</span><span id="line-1319">        // *field_attr_indexes :UNSIGNED5 [SUM(*field_attr_count)]</span>
<span class="source-line-no">1320</span><span id="line-1320">        encodedBand = encodeBandInt("field_attr_calls", field_attr_calls, Codec.UNSIGNED5);</span>
<span class="source-line-no">1321</span><span id="line-1321">        out.write(encodedBand);</span>
<span class="source-line-no">1322</span><span id="line-1322">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from field_attr_calls[" + field_attr_calls.length + "]");</span>
<span class="source-line-no">1323</span><span id="line-1323"></span>
<span class="source-line-no">1324</span><span id="line-1324">        encodedBand = encodeBandInt("fieldConstantValueKQ", cpEntryListToArray(fieldConstantValueKQ), Codec.UNSIGNED5);</span>
<span class="source-line-no">1325</span><span id="line-1325">        out.write(encodedBand);</span>
<span class="source-line-no">1326</span><span id="line-1326">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from fieldConstantValueKQ[" + fieldConstantValueKQ.size() + "]");</span>
<span class="source-line-no">1327</span><span id="line-1327"></span>
<span class="source-line-no">1328</span><span id="line-1328">        encodedBand = encodeBandInt("fieldSignature", cpEntryListToArray(fieldSignature), Codec.UNSIGNED5);</span>
<span class="source-line-no">1329</span><span id="line-1329">        out.write(encodedBand);</span>
<span class="source-line-no">1330</span><span id="line-1330">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from fieldSignature[" + fieldSignature.size() + "]");</span>
<span class="source-line-no">1331</span><span id="line-1331"></span>
<span class="source-line-no">1332</span><span id="line-1332">        field_RVA_bands.pack(out);</span>
<span class="source-line-no">1333</span><span id="line-1333">        field_RIA_bands.pack(out);</span>
<span class="source-line-no">1334</span><span id="line-1334">        for (final NewAttributeBands bands : fieldAttributeBands) {</span>
<span class="source-line-no">1335</span><span id="line-1335">            bands.pack(out);</span>
<span class="source-line-no">1336</span><span id="line-1336">        }</span>
<span class="source-line-no">1337</span><span id="line-1337">    }</span>
<span class="source-line-no">1338</span><span id="line-1338"></span>
<span class="source-line-no">1339</span><span id="line-1339">    private void writeMethodAttributeBands(final OutputStream out) throws IOException, Pack200Exception {</span>
<span class="source-line-no">1340</span><span id="line-1340">        byte[] encodedBand = encodeFlags("method_flags", method_flags, Codec.UNSIGNED5, Codec.UNSIGNED5, segmentHeader.have_method_flags_hi());</span>
<span class="source-line-no">1341</span><span id="line-1341">        out.write(encodedBand);</span>
<span class="source-line-no">1342</span><span id="line-1342">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from method_flags[" + method_flags.length + "]");</span>
<span class="source-line-no">1343</span><span id="line-1343"></span>
<span class="source-line-no">1344</span><span id="line-1344">        // *method_attr_count :UNSIGNED5 [COUNT(1&lt;&lt;16,...)]</span>
<span class="source-line-no">1345</span><span id="line-1345">        // *method_attr_indexes :UNSIGNED5 [SUM(*method_attr_count)]</span>
<span class="source-line-no">1346</span><span id="line-1346">        encodedBand = encodeBandInt("method_attr_calls", method_attr_calls, Codec.UNSIGNED5);</span>
<span class="source-line-no">1347</span><span id="line-1347">        out.write(encodedBand);</span>
<span class="source-line-no">1348</span><span id="line-1348">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from method_attr_calls[" + method_attr_calls.length + "]");</span>
<span class="source-line-no">1349</span><span id="line-1349"></span>
<span class="source-line-no">1350</span><span id="line-1350">        encodedBand = encodeBandInt("methodExceptionNumber", methodExceptionNumber.toArray(), Codec.UNSIGNED5);</span>
<span class="source-line-no">1351</span><span id="line-1351">        out.write(encodedBand);</span>
<span class="source-line-no">1352</span><span id="line-1352">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from methodExceptionNumber[" + methodExceptionNumber.size() + "]");</span>
<span class="source-line-no">1353</span><span id="line-1353"></span>
<span class="source-line-no">1354</span><span id="line-1354">        encodedBand = encodeBandInt("methodExceptionClasses", cpEntryListToArray(methodExceptionClasses), Codec.UNSIGNED5);</span>
<span class="source-line-no">1355</span><span id="line-1355">        out.write(encodedBand);</span>
<span class="source-line-no">1356</span><span id="line-1356">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from methodExceptionClasses[" + methodExceptionClasses.size() + "]");</span>
<span class="source-line-no">1357</span><span id="line-1357"></span>
<span class="source-line-no">1358</span><span id="line-1358">        encodedBand = encodeBandInt("methodSignature", cpEntryListToArray(methodSignature), Codec.UNSIGNED5);</span>
<span class="source-line-no">1359</span><span id="line-1359">        out.write(encodedBand);</span>
<span class="source-line-no">1360</span><span id="line-1360">        PackingUtils.log("Wrote " + encodedBand.length + " bytes from methodSignature[" + methodSignature.size() + "]");</span>
<span class="source-line-no">1361</span><span id="line-1361"></span>
<span class="source-line-no">1362</span><span id="line-1362">        method_RVA_bands.pack(out);</span>
<span class="source-line-no">1363</span><span id="line-1363">        method_RIA_bands.pack(out);</span>
<span class="source-line-no">1364</span><span id="line-1364">        method_RVPA_bands.pack(out);</span>
<span class="source-line-no">1365</span><span id="line-1365">        method_RIPA_bands.pack(out);</span>
<span class="source-line-no">1366</span><span id="line-1366">        method_AD_bands.pack(out);</span>
<span class="source-line-no">1367</span><span id="line-1367">        for (final NewAttributeBands bands : methodAttributeBands) {</span>
<span class="source-line-no">1368</span><span id="line-1368">            bands.pack(out);</span>
<span class="source-line-no">1369</span><span id="line-1369">        }</span>
<span class="source-line-no">1370</span><span id="line-1370">    }</span>
<span class="source-line-no">1371</span><span id="line-1371">}</span>




























































</pre>
</div>
</main>
</body>
</html>
